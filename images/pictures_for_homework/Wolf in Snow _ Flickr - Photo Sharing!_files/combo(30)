YUI.add("hermes-template-fave",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){return"is-faved"}function h(e,t){return"can-not-fave"}function p(e,t){var r,i;return i={hash:{},data:t},f((r=n.formatNumber||e.formatNumber,r?r.call(e,(r=e.photo,r==null||r===!1?r:r.faveCount),i):a.call(e,"formatNumber",(r=e.photo,r==null||r===!1?r:r.faveCount),i)))}function d(e,t){var r,i;return i=n["if"].call(e,(r=e.photo,r==null||r===!1?r:r.faveCount),{hash:{},inverse:l.noop,fn:l.program(8,v,t),data:t}),i||i===0?i:""}function v(e,t){var r,i;return i={hash:{},data:t},f((r=n.friendlyNumber||e.friendlyNumber,r?r.call(e,(r=e.photo,r==null||r===!1?r:r.faveCount),i):a.call(e,"friendlyNumber",(r=e.photo,r==null||r===!1?r:r.faveCount),i)))}function m(e,t){var r="",i;r+='\n		    <a href="#" title="',i=n["if"].call(e,e.loadingView,{hash:{},inverse:l.program(13,y,t),fn:l.program(11,g,t),data:t});if(i||i===0)r+=i;return r+='" data-action="fave"></a>\n		',r}function g(e,t){var r,i;return i={hash:{intlName:"fave-view.LOADING_FAVES"},data:t},f((r=n.intlMessage||e.intlMessage,r?r.call(e,i):a.call(e,"intlMessage",i)))}function y(e,t){var r,i;return i=n["if"].call(e,(r=e.photo,r==null||r===!1?r:r.isFaved),{hash:{},inverse:l.program(16,w,t),fn:l.program(14,b,t),data:t}),i||i===0?i:""}function b(e,t){var r,i;return i={hash:{intlName:"fave-view.UNFAVE_PHOTO"},data:t},f((r=n.intlMessage||e.intlMessage,r?r.call(e,i):a.call(e,"intlMessage",i)))}function w(e,t){var r,i;return i={hash:{intlName:"fave-view.FAVE_PHOTO"},data:t},f((r=n.intlMessage||e.intlMessage,r?r.call(e,i):a.call(e,"intlMessage",i)))}function E(e,t){var r="",i,s;return r+='\n		    <a href="#" title="',s={hash:{intlName:"fave-view.WHO_FAVED"},data:t},r+=f((i=n.intlMessage||e.intlMessage,i?i.call(e,s):a.call(e,"intlMessage",s)))+'" data-action="showfaves"></a>\n		',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l=this;s+='<div class="button">\n	<span class="fave-star ',u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.isFaved),{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(u||u===0)s+=u;s+=" ",u=n.unless.call(t,(o=t.photo,o==null||o===!1?o:o.canFave),{hash:{},inverse:l.noop,fn:l.program(3,h,i),data:i});if(u||u===0)s+=u;s+='">\n		<svg class="icon icon-fave"><use xlink:href="#icon-fave"></use></svg>\n		<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n	</span>\n	<span class="fave-count" unselectable="on">',u=n["if"].call(t,t.realFullscreen,{hash:{},inverse:l.program(7,d,i),fn:l.program(5,p,i),data:i});if(u||u===0)s+=u;s+='</span>\n\n	<div class="button-overlay">\n	    ',u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.canFave),{hash:{},inverse:l.noop,fn:l.program(10,m,i),data:i});if(u||u===0)s+=u;s+="\n		",u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.faveCount),{hash:{},inverse:l.noop,fn:l.program(18,E,i),data:i});if(u||u===0)s+=u;return s+="\n	</div>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/fave",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("fave-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.photoId=e.photoId,this.offNetworkFave=e.offNetworkFave||!1,this.hideWhoFaved=e.hideWhoFaved||!1;if(this.get("container").get("innerHTML")===""){var t=this.templates("fave")({photo:{canFave:!1},loadingView:!0});this.setContainerHTML(t)}return this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this.realFullscreen=!!e.realFullscreen,this},buildContainer:function(){var e=this.get("photo-engagement"),t;return t=this.templates("fave")({photo:e.toJSON(),realFullscreen:this.realFullscreen}),this.setContainerHTML(t),this},loadState:function(){var t=this,n=this.appContext.getViewer(),r=[];return r.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(e){t.set("photo-engagement",e)})),n.signedIn&&r.push(this.appContext.getModelRegistry("favorite-models").then(function(e){t.set("favoriteModelRegistry",e)})),n.signedIn&&t.appContext.getModel("person-models",n.nsid).then(function(e){t.set("viewer-person-model",e)}),e.Promise.all(r)},activate:function(){var t=this.get("photo-engagement"),n=this,r,i=this.appContext.getViewer().prefs.keyboardShortcutsEnabled,s,o=this.appContext.getViewer().nsid,u=this.get("container").one(".fave-star");return t&&this.registerEventHandler(t.on("valuesChanged",function(r){var i,a=typeof r.faveCount!="undefined"||typeof r.isFaved!="undefined"||typeof r.canFave!="undefined";if(!a)return;u.addClass("is-transitioning"),setTimeout(function(){r.isFaved.newVal?u.addClass("is-faved"):u.removeClass("is-faved")},225),setTimeout(function(){u.removeClass("is-transitioning")},300),n.get("favoriteModelRegistry").exists(o)&&(s=n.get("favoriteModelRegistry").proxy(o).getValue("photoPageList"),r.isFaved&&r.isFaved.newVal?n.appContext.getModel("photo-models",r.isFaved.id).then(function(e){s.unshift(e)}):s.remove(r.isFaved.id)),i=t.remoteUpdate(),i.then(function(){n.processingFave=!1},function(i){i.code!==3&&(i.code!==5&&e.Object.each(r,function(e,n){t.setValue(n,e.prevVal)}),n.fire("subviewViewEvent","getDialogOffset",function(t){var r=e.Views.dialog.getInstance("dialog-alert",{content:n.intlMessage({intlName:"fave-view.COULDNT_FAVE"}),attrs:{title:n.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:n.intlMessage({intlName:"common.OK"})},appContext:n.appContext,dialogClass:"scrappy-dialog",offsetLeft:t});r.show()})),n.processingFave=!1}).then(null,function(t){n.processingFave=!1,e.Flog.error("error",t)})},n.photoId)),r={":fave":n.faveStarClicked},this.attachEvents(r),i&&n.attachKeyEvent("down:70",n.faveStarClicked.bind(n)),this},showSignUpAndFaveModal:function(t){var n=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),r=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"}),i;i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:n,signUpMessage:r,beaconPrefix:"fave"}),i.on("signUpClick",function(n){e.SigninHelper.signUpPendingFave({id:t})}),i.on("signInClick",function(n){e.SigninHelper.addPendingFave({id:t})}),i.show()},faveStarClicked:function(t,n){var r=this,i=this.get("photo-engagement"),s=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_MESSAGE"}),o=this.intlMessage({intlName:"fave-view.SIGN_IN_AND_FAVE"}),u=this.intlMessage({intlName:"common.CANCEL"}),a;t.preventDefault();if(this.processingFave)return;e.rapidTracker.beacon(this.name,"faveButtonClick"),this.processingFave=!0,this.bringIntoFocus();if(!this.appContext.getViewer().signedIn){if(this.offNetworkFave){e.SigninHelper.addPendingFave({id:this.photoId},{withPopup:!0,closeWhenDone:!0}),this.processingFave=!1;return}if(this.signedOutTest)return this.processingFave=!1,this.showSignUpAndFaveModal(this.photoId);a=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),htmlMessage:s,actionButtonLabel:o,cancelButtonLabel:u}),a.on("actionClick",function(){e.rapidTracker.beacon(r.name,"faveModalSigninClick"),e.SigninHelper.addPendingFave({id:r.photoId})}),a.on("cancelClick",function(t){e.rapidTracker.beacon(r.name,"faveModalCancelClick")}),a.show(),this.processingFave=!1}else i.getValue("canFave")&&(i.registry.toggleFave(this.photoId),e.rapidTracker.beacon(this.name,"faveStarActionBarButtonClick"))}})},"@VERSION@",{requires:["flickr-view","hermes-template-fave","fave-css","fluid-modal-view","dialog","signin-helper","hermes-template-fave-menu","hermes-template-person","animation-manager"],optional:["photo-engagement-models","photo-people-who-faved-models","person-models","favorite-models"],langBundles:["fave-view","common"]});
YUI.add("hermes-template-dialog-cta-reboot",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var n="",r;return n+='\n		<h1 class="ui-dialog-title">'+l((r=(r=e.attrs,r==null||r===!1?r:r.title),typeof r===f?r.apply(e):r))+"</h1>\n	",n}function d(e,t){var n="",r;return n+='\n		<div class="ui-dialog-icon">\n			<i class="ui-icon-big-'+l((r=(r=e.attrs,r==null||r===!1?r:r.icon),typeof r===f?r.apply(e):r))+'"></i>\n		</div>\n	',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="ui-dialog-wrapper ui-dialog ui-dialog-cta ui-dialog-cta-reboot">\n	',u=n["if"].call(t,(o=t.attrs,o==null||o===!1?o:o.title),{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n	",u=n["if"].call(t,(o=t.attrs,o==null||o===!1?o:o.icon),{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(u||u===0)s+=u;return s+='\n\n	<div class="ui-dialog-body">\n		',a={hash:{},data:i},s+=l((o=n.dialogOutlet||t.dialogOutlet,o?o.call(t,t.content,a):h.call(t,"dialogOutlet",t.content,a)))+"\n	</div>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/dialog-cta-reboot",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-feather-aviary-save-dialog",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="save-aviary-changes">\n 	<button class="alt aviary-upload">',u={hash:{intlName:"aviary.SAVE"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</button>\n 	<button class="aviary-replace">',u={hash:{intlName:"common.REPLACE"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+"</button>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/feather-aviary-save-dialog",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-aviary-cross-platform-edit-warning",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="aviary-cross-platform-warning">\n	<div class="choose-source-message">\n		',u={hash:{intlName:"aviary.CROSS_PLATFORM_EDIT_WARNING"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'\n	</div>\n	<div class="choose-action">\n		<button class="aviary-replace">',u={hash:{intlName:"common.REPLACE"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+'</button>\n		<button class="alt aviary-upload">',u={hash:{intlName:"aviary.SAVE"},data:i},s+=f((o=n.intlMessage||t.intlMessage,o?o.call(t,u):a.call(t,"intlMessage",u)))+"</button>\n	</div>\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/aviary-cross-platform-edit-warning",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("feather-aviary-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.backToURL=e.backToURL,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this,n=new e.FlickrPromise({photo:t.appContext.getModel("photo-models",t.photoId)});return n.then(function(e){t.set("photo",e.photo)})},buildContainer:function(){return this},mapLanguage:function(e){var t={"de-DE":"de","en-US":"en","es-US":"es","fr-FR":"fr","id-ID":"id","it-IT":"it","ko-KR":"ko","pt-BR":"pt_BR","vi-VN":"vi","zh-Hant-HK":"zh_HANT"};return t[e]},responseFromAviaryFrame:function(t){var n=this.get("photo"),r="https:",i,s,o,u,a=e.guid(),f,l,c,h,p,d,v,m=this,g,y=/^https:\/\/s3.amazonaws.com\/hires.aviary.com\/k\/e387fafbf27235a7\/.+/,b="https://s.yimg.com",w={sendAuthParamsToiFrame:"Give new auth params",sendAuthParamsToPollAviaryJobStatus:"Give polling auth params",iFrameIsReady:"iFrame is ready",aviaryEditorClosed:"Aviary Editor is closed",aviaryError:"Error"},E;i=r+n.getLargestSize().url,s=r+n.getValue("sizes").o.url,o=n.getValue("oWidth"),u=n.getValue("oHeight"),t.origin===b&&m.isValidFlickrPhoto(i)&&m.isValidFlickrPhoto(s)&&(t.data===w.iFrameIsReady&&this.handShakeIntervalRef||t.data===w.sendAuthParamsToiFrame||t.data===w.sendAuthParamsToPollAviaryJobStatus?(this.handShakeIntervalRef&&(clearInterval(this.handShakeIntervalRef),clearTimeout(this.iframeTimeoutRef),this.handShakeIntervalRef=!1,this.iframeTimeoutRef=!1),m.appContext.callAPI("flickr.aviary.createSignature",{salt:a}).then(function(e){p=m.mapLanguage(m.appContext.lang),d=m.get("photo").getValue("rotation"),d/90%2&&(o=n.getValue("oHeight"),u=n.getValue("oWidth")),f=e.signature&&e.signature.apiKey?e.signature.apiKey:null,h=e.signature&&e.signature.content?e.signature.content:null,l=e.signature&&e.signature.timestamp?e.signature.timestamp.toString():null,c=e.signature&&e.signature.method?e.signature.method:null,t.data===w.iFrameIsReady?E="Editor setup":t.data===w.sendAuthParamsToiFrame?E="Save auth":t.data===w.sendAuthParamsToPollAviaryJobStatus&&(E="Polling auth"),g={purpose:E,originalPhotoURL:s,originalPhotoWidth:o,originalPhotoHeight:u,largestPhotoURL:i,salt:a,apiKey:f,signature:h,timeStamp:l,hashing:c,language:p,rotation:d},t.source.postMessage(g,b)},function(t){e.Flog.error("[feather-aviary-view] Error generating Signature for Aviary ("+t+")"),m.onError(m.intlMessage({intlName:"errors.ERROR_HAS_OCCURRED"})),e.use("rrd",function(e){e.RRD.queue({event:"flickr.hermes.aviarySignature.creation.failure",title:"Aviary signature creation API Failure"},e.url("/beacon_flanal_reboot_event.gne"))})})):t.data===w.aviaryEditorClosed?(this.aviaryDialog.close(),e.config.win.removeEventListener("message",this.messageListenerFunction,!1)):t.data.indexOf("Error:")!==-1?(e.rapidTracker.beacon(m.name,"aviaryError"),e.Flog.error("[feather-aviary-view] Aviary Editor has returned an error: ("+t.data+")"),e.use("rrd",function(e){e.RRD.queue({event:"flickr.hermes.aviaryEditor.failure",title:"Aviary Editor Failure"},e.url("/beacon_flanal_reboot_event.gne"))}),v=new e.Views.FluidModal({appContext:m.appContext,dismissOnOverlayClick:!0,showBodyLines:!1,showCancelButton:!0,showActionButton:!0,showCancelX:!0,title:this.intlMessage({intlName:"common.RETRY"}),message:this.intlMessage({intlName:"aviary.RETRY_DIALOG_MESSAGE"}),actionButtonLabel:this.intlMessage({intlName:"common.RETRY"})}),v.on("actionClick",function(n){m.appContext.callAPI("flickr.aviary.createSignature",{salt:a}).then(function(e){f=e.signature&&e.signature.apiKey?e.signature.apiKey:null,h=e.signature&&e.signature.content?e.signature.content:null,l=e.signature&&e.signature.timestamp?e.signature.timestamp.toString():null,c=e.signature&&e.signature.method?e.signature.method:null,g={purpose:"Save auth",originalPhotoURL:s,largestPhotoURL:i,salt:a,apiKey:f,signature:h,timeStamp:l,hashing:c,language:p,rotation:d},t.source.postMessage(g,b)},function(t){e.Flog.error("[feather-aviary-view] Error generating Signature for Aviary ("+t+")"),m.onError(m.intlMessage({intlName:"errors.ERROR_HAS_OCCURRED"})),e.use("rrd",function(e){e.RRD.queue({event:"flickr.hermes.aviarySignature.creation.failure",title:"Aviary signature creation API Failure"},e.url("/beacon_flanal_reboot_event.gne"))})})}),v.show()):(!m.urlFromAviary||m.urlFromAviary==="")&&y.test(t.data)&&m.saveFromAviary(t.data))},isValidFlickrPhoto:function(e){return e.indexOf("s.yimg.com")===-1&&e.indexOf("photo_unavailable")===-1},aviaryReplaceImage:function(t,n){var r=new FormData,i,s=e.config.flickr.api.hostname_client_replace,o,u,a=this;n=n.split(" "),a.saveModal&&!a.saveModal.get("container").one(".body").hasClass("loading")?a.saveModal.get("container").one(".body").addClass("loading").append(a.templates("flickr-balls")({})):a.chooseEditingSourceModal&&!a.chooseEditingSourceModal.get("container").one(".body").hasClass("loading")&&a.chooseEditingSourceModal.get("container").one(".body").addClass("loading").append(a.templates("flickr-balls")({})),r.append("api_key",e.config.flickr.api.site_key),r.append("csrf",e.config.flickr.csrf.token),r.append("external_image_link",n[0]),r.append("photo_id",a.photoId),r.append("clone_meta_from_photo_id",1),a.appContext.flipper.isFlipped("enable-non-destructive-edits")&&(r.append("store_original",1),r.append("client",3),r.append("meta",n[1])),i=new XMLHttpRequest,i.open("POST",s,!0),i.withCredentials=!0,o=function(t){var n=typeof t=="object"?t.target.statusText:t+"";a.urlFromAviary="",e.Flog.error("[feather-aviary-view] aviary-edit: Error replacing the Image ("+n+")"),a.onError(a.intlMessage({intlName:"errors.ERROR_REPLACING"})),e.use("rrd",function(e){e.RRD.queue({event:"flickr.hermes.replace.failure",title:"Replace API Failure"},e.url("/beacon_flanal_reboot_event.gne"))})},u=function(t){var n,r,i;a.urlFromAviary="";try{i=document.createElement("div"),i.innerHTML=t.target.responseText
,r=i.getElementsByTagName("rsp")[0]||"",r&&(r=r.getAttribute("stat")||""),n=i.getElementsByTagName("err")[0]||"",n&&(n=n.getAttribute("msg")||"")}catch(s){r="",n=""}if(r!=="ok")return o((r||"empty")+": "+(n||"no message"));e.use("rrd",function(e){e.RRD.queue({event:"flickr.hermes.replace.success",title:"Aviary Replace Image successful"},e.url("/beacon_flanal_reboot_event.gne"))}),a.fire("subviewViewEvent","photo:reload")},i.addEventListener("load",u),i.addEventListener("error",o),i.send(r)},aviaryUploadImage:function(t,n){var r=new FormData,i,s="https://up.flickr.com/services/upload",o,u,a=this;a.saveModal&&!a.saveModal.get("container").one(".body").hasClass("loading")?a.saveModal.get("container").one(".body").addClass("loading").append(a.templates("flickr-balls")({})):a.chooseEditingSourceModal&&!a.chooseEditingSourceModal.get("container").one(".body").hasClass("loading")&&a.chooseEditingSourceModal.get("container").one(".body").addClass("loading").append(a.templates("flickr-balls")({})),r.append("api_key",e.config.flickr.api.site_key),r.append("csrf",e.config.flickr.csrf.token),r.append("external_image_link",n),r.append("clone_meta_from_photo_id",a.photoId),i=new XMLHttpRequest,i.open("POST",s,!0),i.withCredentials=!0,o=function(t){var n=typeof t=="object"?t.target.statusText:t+"";a.urlFromAviary="",e.Flog.error("[feather-aviary-view] aviary-edit: Error during Aviary edited image upload ("+n+")"),a.onError(a.intlMessage({intlName:"errors.ERROR_SAVING"})),e.use("rrd",function(e){e.RRD.queue({event:"flickr.hermes.upload.failure",title:"Upload API Failure"},e.url("/beacon_flanal_reboot_event.gne"))})},u=function(t){var n,r,i,s,u=a.get("photo").getValue("owner");a.urlFromAviary="";try{i=document.createElement("div"),i.innerHTML=t.target.responseText,r=i.getElementsByTagName("rsp")[0]||"",r&&(r=r.getAttribute("stat")||""),s=i.getElementsByTagName("photoid")[0].innerHTML||"",n=i.getElementsByTagName("err")[0]||"",n&&(n=n.getAttribute("msg")||"")}catch(f){r="",n=""}if(r!=="ok")return o((r||"empty")+": "+(n||"no message"));e.use("rrd",function(e){e.RRD.queue({event:"flickr.hermes.upload.success",title:"Aviary upload as a new Image successful"},e.url("/beacon_flanal_reboot_event.gne"))}),window.location="/photos/"+(u.getValue("pathAlias")||u.getValue("nsid"))+"/"+s},i.addEventListener("load",u),i.addEventListener("error",o),i.send(r)},saveFromAviary:function(t){var n=this,r,i=t.split(" ")[0];n.saveModal=new e.Views.FluidModal({appContext:n.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!1,dismissOnCancelClick:!1,showBodyLines:!1,showCancelButton:!1,showActionButton:!1,showCancelX:!0,title:this.intlMessage({intlName:"aviary.SAVE_PHOTO"}),message:this.templates("feather-aviary-save-dialog")({}),hideModalOverlay:!0,showButtons:!1,classList:"aviary-save-dialog"}),n.saveModal.show(),r=n.saveModal.get("container"),n.saveModal.on("activated",function(){r.one(".aviary-upload").on("click",n.aviaryUploadImage.bind(n),null,i),n.appContext.flipper.isFlipped("enable-non-destructive-edits")?r.one(".aviary-replace").on("click",n.checkForPreviousEdits.bind(n),null,t):r.one(".aviary-replace").on("click",n.aviaryReplaceImage.bind(n),null,t)})},aviaryEditSelected:function(){var t=this,n=this.get("photo"),r=window.YUI_config.groups.hermes.base,i,s=r+"html/feather_aviary.html",o,u,a,f,l=e.one("body");t.aviaryDialog&&(t.aviaryDialog.close(),t.aviaryDialog=null),t.saveModal&&(t.saveModal.close(),t.saveModal=null),t.chooseEditingSourceModal&&(t.chooseEditingSourceModal.close(),t.chooseEditingSourceModal=null);try{u=parseInt(n.getValue("sizes").o.width,10),a=parseInt(n.getValue("sizes").o.height,10)}catch(c){}f=u*a/1e6,f&&f<50?(t.aviaryDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:'<iframe id="aviary-iframe"></iframe>',appContext:t.appContext,tintCurtain:.5,dialogClass:"scrappy-dialog aviary-dialog"}),t.aviaryDialog.show(),i=t.aviaryDialog.get("container").one("#aviary-iframe"),i.setAttribute("seamless","seamless"),i.setAttribute("frameborder","0"),i.setAttribute("scrolling","no"),i.setAttribute("marginheight","0"),i.setAttribute("marginwidth","0"),i.set("src",s),e.one(".aviary-dialog").setStyles({marginLeft:-((l.get("winWidth")-50)/2),marginTop:-((l.get("winHeight")-100)/2)}),i.setStyles({width:l.get("winWidth")-100,height:l.get("winHeight")-100}),o=i.getDOMNode().contentWindow,t.handShakeIntervalRef=setInterval(function(){try{o.postMessage("Is the iFrame ready?","https://s.yimg.com")}catch(e){}},200),t.iframeTimeoutRef=setTimeout(function(){t.handShakeIntervalRef&&(clearInterval(t.handShakeIntervalRef),t.onError(t.intlMessage({intlName:"aviary.ERROR"})))},2e4),this.messageListenerFunction=this.responseFromAviaryFrame.bind(this),e.config.win.addEventListener("message",this.messageListenerFunction,!1)):f?t.onError(t.intlMessage({intlName:"aviary.IMAGE_TOO_LARGE"})):t.onError(t.intlMessage({intlName:"aviary.NO_ORIGINAL_PHOTO"}))},checkForPreviousEdits:function(t,n){var r=this,i={},s;i.photo_id=r.photoId,r.saveModal&&!r.saveModal.get("container").one(".body").hasClass("loading")&&r.saveModal.get("container").one(".body").addClass("loading").append(r.templates("flickr-balls")({})),r.appContext.callAPI("flickr.photos.getEdits",i).then(function(t){var i=t.edits;i&&i.client&&parseInt(i.client,10)!==3?(r.saveModal&&(r.saveModal.close(),r.saveModal=null),r.chooseEditingSourceModal=new e.Views.FluidModal({appContext:r.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!1,dismissOnCancelClick:!1,showBodyLines:!1,showCancelButton:!1,showActionButton:!1,showCancelX:!0,title:r.intlMessage({intlName:"aviary.SAVE_PHOTO"}),message:r.templates("aviary-cross-platform-edit-warning")({}),hideModalOverlay:!0,showButtons:!1,classList:"aviary-cross-platform-edit-warning-dialog"}),r.chooseEditingSourceModal.show(),s=r.chooseEditingSourceModal.get("container"),r.chooseEditingSourceModal.on("activated",function(){s.one(".aviary-upload").on("click",r.aviaryUploadImage.bind(r),null,n.split(" ")[0]),s.one(".aviary-replace"
).on("click",r.aviaryReplaceImage.bind(r),null,n)})):r.aviaryReplaceImage.bind(r)(null,n)},function(t){e.Flog.error("[feather-aviary-view] Error getting previous edits for this photo"),r.onError(r.intlMessage({intlName:"errors.ERROR_HAS_OCCURRED"}))})},activate:function(){var t=this;return e.one(".aviary-dialog")&&e.one(".aviary-dialog").remove(!0),t.aviaryEditSelected.bind(t)(),!1},onError:function(t){var n=this,r;n.aviaryDialog&&(n.aviaryDialog.close(),n.aviaryDialog=null),n.saveModal&&(n.saveModal.close(),n.saveModal=null),n.chooseEditingSourceModal&&(n.chooseEditingSourceModal.close(),n.chooseEditingSourceModal=null),r=new e.Views.FluidModal({appContext:n.appContext,title:n.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:n.intlMessage({intlName:"common.OK"}),showCancelButton:!1,hideModalOverlay:!0}),r.show()},destructor:function(){this.handShakeIntervalRef&&clearInterval(this.handShakeIntervalRef),this.iframeTimeoutRef&&clearTimeout(this.iframeTimeoutRef),this.handShakeIntervalRef=null,this.iframeTimeoutRef=null,this.aviaryDialog&&(this.aviaryDialog.close(),this.aviaryDialog=null),this.saveModal&&(this.saveModal.close(),this.saveModal=null),this.chooseEditingSourceModal&&(this.chooseEditingSourceModal.close(),this.chooseEditingSourceModal=null)}})},"@VERSION@",{requires:["flickr-view","flog","url-helper","dialog","confirmation-dialog-view","flickr-promise","hermes-template-feather-aviary-save-dialog","hermes-template-aviary-cross-platform-edit-warning","fluid-balls-css","fluid-modal-view","hermes-template-flickr-balls"],langBundles:["common","aviary","errors"],optional:[]});
YUI.add("hermes-lang-aviary_zh-hant-hk",function(e,t){e.Intl.add("hermes/aviary","zh-Hant-HK",{SAVE:["\u5132\u5b58\u65b0\u526f\u672c"],SAVE_PHOTO:["\u5132\u5b58\u6b64\u76f8\u7247"],ERROR:["\u4f7f\u7528 Aviary \u6642\u767c\u751f\u932f\u8aa4\u3002 \u8acb\u518d\u8a66\u4e00\u6b21\u3002"],ENHANCE:["\u52a0\u5f37\u6548\u679c"],IMAGE_TOO_LARGE:["\u62b1\u6b49\uff0c\u6b64\u5716\u7247\u592a\u5927\uff0c\u56e0\u6b64\u7121\u6cd5\u7de8\u8f2f\u3002 \u8acb\u4f7f\u7528\u5c0f\u65bc 5 \u5343\u842c\u50cf\u7d20\u7684\u5716\u7247\u518d\u8a66\u4e00\u6b21\u3002"],NO_ORIGINAL_PHOTO:["\u7121\u6cd5\u53d6\u5f97\u539f\u59cb\u76f8\u7247\u3002 \u8acb\u518d\u8a66\u4e00\u6b21\u3002"],RETRY_DIALOG_MESSAGE:["\u9700\u6642\u6bd4\u5e73\u5e38\u7a0d\u9577\u3002 \u4f60\u60f3\u8981\u91cd\u65b0\u5617\u8a66\u5132\u5b58\u8b8a\u66f4\u55ce\uff1f"],EDIT_IN_AVIARY:["\u5728 Aviary \u4e2d\u7de8\u8f2f"],SELECT_PHOTO_TO_EDIT:["\u9078\u64c7\u76f8\u7247\u4ee5\u9032\u884c\u7de8\u8f2f"],PREVIOUS_EDIT_WARNING:["\u4f60\u4e4b\u524d\u5df2\u5728\u884c\u52d5\u88dd\u7f6e\u4e0a\u7de8\u8f2f\u4e86\u9019\u5f35\u76f8\u7247\u3002\u8acb\u9078\u64c7\u7de8\u8f2f\u76ee\u524d\u7684\u7248\u672c\u6216\u76f8\u7247\u539f\u6a94\u3002\u5982\u679c\u4f60\u9078\u64c7\u76ee\u524d\u7684\u7248\u672c\uff0c\u5c07\u7121\u6cd5\u5fa9\u539f\u5148\u524d\u5728\u884c\u52d5\u88dd\u7f6e\u4e0a\u6240\u9032\u884c\u7684\u7de8\u8f2f\u3002"],ORIGINAL_LABEL:["\u539f\u6a94"],CURRENT_LABEL:["\u76ee\u524d"],ORIGINAL_IMAGE:["\u76f8\u7247\u539f\u6a94"],CURRENT_IMAGE:["\u76ee\u524d\u76f8\u7247"],CROSS_PLATFORM_EDIT_WARNING:["\u4f60\u6700\u8fd1\u5728\u884c\u52d5\u88dd\u7f6e\u4e0a\u7de8\u8f2f\u4e86\u9019\u5f35\u76f8\u7247\u3002\u5982\u679c\u4f60\u9078\u64c7\u53d6\u4ee3\u9019\u5f35\u76f8\u7247\uff0c\u5c07\u7121\u6cd5\u518d\u5fa9\u539f\u5148\u524d\u5728\u884c\u52d5\u88dd\u7f6e\u4e0a\u6240\u9032\u884c\u7684\u7de8\u8f2f\u3002"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-lang-errors_zh-hant-hk",function(e,t){e.Intl.add("hermes/errors","zh-Hant-HK",{UNAUTHORIZED_ACCESS:["\u672a\u6388\u6b0a\u5b58\u53d6"],YOU_ARE_NOT_AUTHORIZED:["\u4f60\u5df2\u5617\u8a66\u5b58\u53d6\u672a\u7d93\u6388\u6b0a\u7684\u9801\u9762\u3002"],AUTO_REDIRECT_IN_10_SECONDS:["\u6b64\u9801\u9762\u6703\u5728 10 \u79d2\u5167\u81ea\u52d5\u91cd\u65b0\u5c0e\u5411 Flickr \u9996\u9801\uff0c"],OR_CLICK_LINK_FOR_HOME:["\u6216\u6309\u4e00\u4e0b\u4e0b\u5217\u9023\u7d50\u4ee5\u76f4\u63a5\u79fb\u81f3<a href='/'>\u9996\u9801</a>\u3002"],ERROR:["\u932f\u8aa4"],ERROR_HAS_OCCURRED:["\u767c\u751f\u932f\u8aa4\u3002 \u8acb\u518d\u8a66\u4e00\u6b21\u3002"],ERROR_REPLACING:["\u53d6\u4ee3\u5716\u7247\u6642\u767c\u751f\u932f\u8aa4\u3002 \u8acb\u518d\u8a66\u4e00\u6b21\u3002"],ERROR_SAVING:["\u5132\u5b58\u5716\u7247\u6642\u767c\u751f\u932f\u8aa4\u3002 \u8acb\u518d\u8a66\u4e00\u6b21\u3002"],DOWNLOAD_EXPIRED:["\u4e0b\u8f09\u5df2\u903e\u671f"],DOWNLOAD_NO_LONGER_AVAILABLE:["\u7121\u6cd5\u518d\u4e0b\u8f09\u9019\u4e9b\u9805\u76ee\u3002"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-scrappy-edit-button",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function f(e,t){var r="",i,s;return r+='\n	<div class=\'edit\'>\n		<a href="#" title="',s={hash:{intlName:"photo-page-scrappy.EDIT_PHOTO"},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,s):o.call(e,"intlMessage",s)))+'" class="button">\n			<i class="ui-icon-edit"></i>\n		</a>\n	</div>\n',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o=n.helperMissing,u=this.escapeExpression,a=this;return s=n["if"].call(t,t.viewerIsOwner,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/scrappy-edit-button",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-scrappy-edit-menu",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i,s;r+="\n		",i=n["if"].call(e,e.enableEditInAviary,{hash:{},inverse:f.program(4,h,t),fn:f.program(2,c,t),data:t});if(i||i===0)r+=i;return r+="\n			",s={hash:{intlName:"aviary.EDIT_IN_AVIARY"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n			</a></li>\n		",r}function c(e,t){return'\n			<li><a href="#" class="edit-aviary">\n		'}function h(e,t){var r="",i;r+='\n			<li><a href="#" class="unavailable-feature ',i=n["if"].call(e,e.isVideo,{hash:{},inverse:f.noop,fn:f.program(5,p,t),data:t});if(i||i===0)r+=i;r+='" ',i=n["if"].call(e,e.isVideo,{hash:{},inverse:f.noop,fn:f.program(7,d,t),data:t});if(i||i===0)r+=i;return r+=">\n		",r}function p(e,t){return"isVideo"}function d(e,t){var r="",i,s;return r+='title="',s={hash:{intlName:"photo-page-scrappy.NO_VIDEOS_IN_AVIARY"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+'"}}"',r}function v(e,t){var r="",i,s;r+='\n		<li><a href="#" class="rotate-photo ',i=n["if"].call(e,e.isVideo,{hash:{},inverse:f.noop,fn:f.program(10,m,t),data:t});if(i||i===0)r+=i;r+='" ',i=n["if"].call(e,e.isVideo,{hash:{},inverse:f.noop,fn:f.program(12,g,t),data:t});if(i||i===0)r+=i;return r+=">\n			",s={hash:{intlName:"photo-page-scrappy.ROTATE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n		</a></li>\n	",r}function m(e,t){return"isVideo unavailable-feature"}function g(e,t){var r="",i,s;return r+='title="',s={hash:{intlName:"photo-page-scrappy.NO_VIDEO_ROTATION"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+'"',r}function y(e,t){var r="",i,s;r+='\n		<li><a href="#" class="replace-photo ',i=n["if"].call(e,e.isVideo,{hash:{},inverse:f.noop,fn:f.program(10,m,t),data:t});if(i||i===0)r+=i;r+='" ',i=n["if"].call(e,e.isVideo,{hash:{},inverse:f.noop,fn:f.program(15,b,t),data:t});if(i||i===0)r+=i;return r+=">\n			",s={hash:{intlName:"photo-page-scrappy.REPLACE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n		</a></li>\n	",r}function b(e,t){var r="",i,s;return r+='title="',s={hash:{intlName:"photo-page-scrappy.NO_VIDEO_REPLACE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+'"',r}function w(e,t){var r="",i,s;return r+='\n		<li><a href="#" class="delete-photo">\n			',s={hash:{intlName:"common.DELETE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n		</a></li>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;s+="<ul>\n\n	\n	",o=n["if"].call(t,t.showEditInAviaryLink,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+="\n\n	",o=n["if"].call(t,t.showRotateLink,{hash:{},inverse:f.noop,fn:f.program(9,v,i),data:i});if(o||o===0)s+=o;s+="\n\n	",o=n["if"].call(t,t.showReplaceLink,{hash:{},inverse:f.noop,fn:f.program(14,y,i),data:i});if(o||o===0)s+=o;s+="\n\n	\n\n	",o=n["if"].call(t,t.showDeleteLink,{hash:{},inverse:f.noop,fn:f.program(17,w,i),data:i});if(o||o===0)s+=o;return s+="\n\n</ul>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/scrappy-edit-menu",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-delete-photo-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"Are you sure you want to delete this photo?<br>\n<strong>This cannot be undone.</strong>"}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/delete-photo-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-replace-photo-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i,s;return r+='\n<div class="ui-dialog-wrapper c-dialog-cta-photoreplace">\n	<button class="ui-button ui-dialog-button-close" data-action="dismiss"><span>&nbsp;</span></button>\n	<div class="ui-dialog-description js-description">\n		',s={hash:{intlName:"photo-page-scrappy.ERROR_REPLACING_PHOTO"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+'\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar"></div>\n</div>\n',r}function c(e,t){var r="",i,s,o;r+='\n<div class="ui-dialog-wrapper c-dialog-cta-photoreplace">\n	<div class="ui-dialog-title">\n		<h3>',o={hash:{intlName:"photo-page-scrappy.REPLACE_PHOTO"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+'</h3>\n		<i data-action="dismiss" class="cancel-confirmation ui-dialog-button-close"></i>\n	</div>\n	<div class="dialog-content">\n		<i class="dialog-icon ui-icon-modal-warning"></i>\n		<div class="ui-dialog-description js-description">\n			',s=n["if"].call(e,e.fileName,{hash:{},inverse:f.program(9,v,t),fn:f.program(4,h,t),data:t});if(s||s===0)r+=s;r+='\n		</div>\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar">\n		',s=n["if"].call(e,e.fileName,{hash:{},inverse:f.program(14,y,t),fn:f.program(11,m,t),data:t});if(s||s===0)r+=s;return r+="\n		\n	</div>\n</div>\n",r}function h(e,t){var r="",i;r+="\n				",i=n["if"].call(e,e.uploading,{hash:{},inverse:f.program(7,d,t),fn:f.program(5,p,t),data:t});if(i||i===0)r+=i;return r+="\n			",r}function p(e,t){var r="",i,s;return r+="\n					",s={hash:{intlName:"photo-page-scrappy.REPLACE_UPLOADING",fileName:e.fileName},data:t},r+=a((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):u.call(e,"intlHTMLMessage",s)))+'\n					<progress min="0" max="100" value="0"></progress>\n				',r}function d(e,t){var r="",i,s;return r+="\n					",s={hash:{intlName:"photo-page-scrappy.PERMANENTLY_REPLACE",photoTitle:e.photoTitle,username:e.username,fileName:e.fileName},data:t},r+=a((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):u.call(e,"intlHTMLMessage",s)))+"\n				",r}function v(e,t){var r="",i,s;return r+="\n				",s={hash:{intlName:"photo-page-scrappy.REPLACE_WARNING"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"\n			",r}function m(e,t){var r="",i;r+="\n			",i=n.unless.call(e,e.uploading,{hash:{},inverse:f.noop,fn:f.program(12,g,t),data:t});if(i||i===0)r+=i;return r+="\n		",r}function g(e,t){var r="",i,s;return r+='\n				<button class="ui-button ui-button-cta c-button-replace ui-dialog-button-done" data-action="submit">',s={hash:{intlName:"photo-page-scrappy.REPLACE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"</button>\n			",r}function y(e,t){var r="",i,s;return r+='\n			<input type="file" name="file" accept="image/*">\n			<button class="ui-button ui-button-cta c-button-changefile ui-dialog-button-done" data-action="change">',s={hash:{intlName:"common.CHOOSE_FILE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"</button>\n		",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;o=n["if"].call(t,t.error,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/replace-photo-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-rotate-photo-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+='\n<div class="ui-dialog-wrapper c-dialog-cta-photorotate">\n	<button class="ui-button ui-dialog-button-close" data-action="dismiss"><span>&nbsp;</span></button>\n	<div class="ui-dialog-description js-description">\n		',s={hash:{intlName:"photo-page-scrappy.ERROR_ROTATING_PHOTO"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+'\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar"></div>\n</div>\n',r}function h(e,t){var r="",i,s,o;r+='\n<div class="ui-dialog-wrapper c-dialog-cta-photorotate">\n	<div class="ui-dialog-description js-description">\n		<button class="ui-button ui-dialog-button-close" data-action="dismiss"><span>&nbsp;</span></button>\n		<h3>',o={hash:{intlName:"photo-page-scrappy.ROTATE_PHOTO"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+'</h3>\n\n		<ul class="c-rotations ',o={hash:{},inverse:f.noop,fn:f.program(4,p,t),data:t},s=(i=n.ifCond||e.ifCond,i?i.call(e,(i=e.preview,i==null||i===!1?i:i.width),"<",(i=e.preview,i==null||i===!1?i:i.height),o):u.call(e,"ifCond",(i=e.preview,i==null||i===!1?i:i.width),"<",(i=e.preview,i==null||i===!1?i:i.height),o));if(s||s===0)r+=s;return r+='">\n			<li><img class="ui-util-rotate-90" src="'+a((i=(i=e.preview,i==null||i===!1?i:i.url),typeof i===l?i.apply(e):i))+'" data-action="select" data-rotation="90"></li>\n			<li><img class="ui-util-rotate-180" src="'+a((i=(i=e.preview,i==null||i===!1?i:i.url),typeof i===l?i.apply(e):i))+'" data-action="select" data-rotation="180"></li>\n			<li><img class="ui-util-rotate-270" src="'+a((i=(i=e.preview,i==null||i===!1?i:i.url),typeof i===l?i.apply(e):i))+'" data-action="select" data-rotation="270"></li>\n		</ul>\n\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar">\n		<button class="ui-button ui-button-cta c-button-rotate ui-dialog-button-done" data-action="submit">',o={hash:{intlName:"photo-page-scrappy.ROTATE_PHOTO"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+"</button>\n	</div>\n</div>\n",r}function p(e,t){return"c-rotations-portrait"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this,l="function";o=n["if"].call(t,t.error,{hash:{},inverse:f.program(3,h,i),fn:f.program(1,c,i),data:i});if(o||o===0)s+=o;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/rotate-photo-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-well-scrappy-edit-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.nsid=e.nsid,this.photoId=e.photoId,this.backToURL=e.backToURL,this.context=e.context;if(this.get("container").get("innerHTML")===""){var t=this.templates("scrappy-edit-button")({loadingView:!0});this.setContainerHTML(t)}return this},subviewConfig:{"feather-aviary-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},loadState:function(){var t=this,n=[];return this.appContext.forceServerRender||n.push(this.appContext.getModel(this.context.modelName,this.context.params).then(function(e){t.set("contextModel",e)}).then(function(){var n=e.merge(t.context.params,{photoId:t.photoId,numNext:1,numPrev:1});return t.get("contextModel").getValue("photoContextList").getContext(n).then(function(){var e,n=t.get("contextModel").getValue("photoContextList").getList(),r=n.length;e=n.map(function(e){return e.getValue("id")}).indexOf(t.photoId),e>=0&&e<r&&t.set("nextPhotoModel",n[e+1]),e>0&&t.set("prevPhotoModel",n[e-1])})})),n.push(this.appContext.getModel("photo-models",t.photoId).then(function(e){t.set("photo",e)})),e.Promise.all(n)},buildContainer:function(){var e,t=this.get("photo").getValue("owner").getValue("isMe");return e=this.templates("scrappy-edit-button")({viewerIsOwner:t}),this.setContainerHTML(e),this},setupDropdown:function(){var t=this.get("container"),n=this.get("photo"),r,i=n.getValue("owner").getValue("isMe"),s=t,o,u=!1,a=!1,f=n.getValue("isVideo"),l=n.getValue("id"),c=this;this.appContext.flipper.isFlipped("turn-off-aviary")&&(a=!0),i&&(u=!0),r=e.URLHelper.getPhotoPage({photoId:n.getValue("id"),pathAlias:n.getValue("owner").getValue("pathAlias")}),o=this.templates("scrappy-edit-menu")({photoURL:r,photoId:l,viewerIsOwner:i,showDeleteLink:i,showRotateLink:i&&!f,showReplaceLink:i&&!f,isVideo:f,showEditInAviaryLink:i&&!f&&!a,enableEditInAviary:u}),this.editMenu=e.Views.dialog.getNewInstance("dialog-tooltip",{content:o,anchorTo:s,dropUp:!0,parent:this,positioning:!1,rootEl:t}),this.editMenu.render(),this.editMenu.on("toggle",function(e){e&&e.details&&e.details.length>0&&(e.details[0]?c.fire("subviewViewEvent","make in view",t):c.fire("subviewViewEvent","close in view"))})},handleMenuButtonClick:function(t){t.preventDefault(),e.rapidTracker.beacon(this.name,"editMenuClick"),this.editMenu.toggle()},handleDeletePhotoClick:function(t){t.preventDefault();var n,r,i=this;this.editMenu.hide(),n=new e.Views["confirmation-dialog-view"]({photoID:this.photoId,appContext:this.appContext,title:this.intlMessage({intlName:"photo-page-scrappy.DELETE_PHOTO"}),content:this.intlMessage({intlName:"photo-page-scrappy.PERMANTENTLY_DELETE"}),confirmButtonLabel:this.intlMessage({intlName:"common.DELETE"}),confirmButtonClass:"ui-dialog-button-negative"}),n.render(),n.activate(),r=n.get("container"),n.registerEventHandler(r.one(".ui-dialog-button-confirm").on("click",this.handleDeletePhotoConfirmClick,this)),n.registerEventHandler(r.one(".ui-dialog-button-close").on("click",function(){i.deleteDialog.close()})),this.fire("subviewViewEvent","getDialogOffset",function(t){i.deleteDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:i.appContext,offsetLeft:t,dialogClass:"scrappy-dialog"}),i.deleteDialog.show()}),e.rapidTracker.beacon(this.name,"deletePhotoClick")},handleDeletePhotoConfirmClick:function(t){var n=this,r=n.get("photo").getValue("owner"),i,s=n.get("nextPhotoModel"),o=n.get("prevPhotoModel");e.rapidTracker.beacon(this.name,"deletePhotoConfirmationClick"),n.deleteDialog.close(),n.deleteDialog.destroy(),this.appContext.callAPI("flickr.photos.delete",{photo_id:this.photoId}).then(function(t){s?i=e.URLHelper.getPhotoPage({photoId:s.getValue("id"),pathAlias:s.getValue("owner").getValue("pathAlias"),contextSuffix:n.get("contextModel").getValue("urlSuffix")}):o?i=e.URLHelper.getPhotoPage({photoId:o.getValue("id"),pathAlias:o.getValue("owner").getValue("pathAlias"),contextSuffix:n.get("contextModel").getValue("urlSuffix")}):i=r.getValue("url")+"?deleted="+n.photoId,e.config.win.location=i},function(e){n.showErrorDialog(n.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_PHOTO"}))})},handleReplacePhotoClick:function(t){t.halt();var n=this.get("container"),r=this,i=this.get("photo").getValue("isVideo");if(i)return;this.editMenu.hide(),this.fire("subviewViewEvent","getDialogOffset",function(t){r.replaceDialog=e.Views.dialog.getNewInstance("dialog-cta",{id:"replace-"+r.photoId,attrs:{},template:"dialog-cta-reboot",content:r.templates("replace-photo-dialog-content"),parent:r,photoTitle:r.get("photo").getValue("title"),username:r.get("photo").getValue("owner").getValue("displayname"),rootEl:n.ancestor(".photo-page-scrappy-view"),offsetLeft:t,dialogClass:"scrappy-dialog"}),r.replaceDialog.attachEvents({"input change:":function(e){e.halt();var t=e.target.getDOMNode().files[0];if(!t)return;r._imgFile=t,r.replaceConfirm()},":submit":function(){r.replaceSubmit()}}),r.replaceDialog.on("hide",function(){r._imgFileXhr&&r._imgFileXhr.abort(),r._imgFileXhr=null,r._imgFile=null,r.replaceDialog.destroy(),r.replaceDialog=null}),r.replaceDialog.show()}),e.rapidTracker.beacon(this.name,"replacePhotoClick")},replaceConfirm:function(){this.replaceDialog.set("fileName",this._imgFile.name),this.replaceDialog.renderContent({photoTitle:this.get("photo").getValue("title"),username:this.get("photo").getValue("owner").getValue("displayname")}),e.rapidTracker.beacon(this.name,"replacePhotoConfirmationClick")},replaceSubmit:function(){var t=new FormData,n=this,r,i,s=e.config.flickr.api.hostname_client_replace,o,u,a;this.replaceDialog.set("uploading",!0),this.replaceDialog.renderContent(),this.replaceDialog.switchToWorking(),t.append("api_key",e.config.flickr.api.site_key),t.append("csrf",e.config.flickr.csrf.token),t.append("photo",this._imgFile,this._imgFile.name),t.append("photo_id",this.photoId),r=this._imgFileXhr=new XMLHttpRequest,r.open
("POST",s,!0),r.withCredentials=!0,u=function(t){var r=typeof t=="object"?t.target.statusText:t+"";n.replaceDialog.switchToWorking(!1),n.replaceDialog.close(),n.showErrorDialog(n.intlMessage({intlName:"photo-page-scrappy.ERROR_REPLACING_PHOTO"})),e.Flog.error("[more-menu-view] photo-replace: error during upload ("+r+")")},a=function(e){var t,r,i;try{i=document.createElement("div"),i.innerHTML=e.target.responseText,r=i.getElementsByTagName("rsp")[0]||"",r&&(r=r.getAttribute("stat")||""),t=i.getElementsByTagName("err")[0]||"",t&&(t=t.getAttribute("msg")||"")}catch(s){r="",t=""}if(r!=="ok")return u((r||"empty")+": "+(t||"no message"));n.replaceDialog.close(),n.fire("subviewViewEvent","photo:reload")},r.addEventListener("load",a),r.addEventListener("error",u),o=n.replaceDialog.get("container").one("progress").getDOMNode(),r.upload.addEventListener("progress",function(e){o.value=i=Math.floor(100*(e.loaded/e.total)),e.loaded===e.total&&o.removeAttribute("value")}),r.send(t)},handleRotatePhotoClick:function(t){t.halt();var n=this,r=240,i=this.get("photo").getValue("isVideo");if(i)return;this.editMenu.hide(),this.fire("subviewViewEvent","getDialogOffset",function(t){n.rotateDialog=e.Views.dialog.getNewInstance("dialog-cta",{id:"rotate-"+n.photoId,attrs:{},template:"dialog-cta-reboot",content:n.templates("rotate-photo-dialog-content"),parent:n,offsetLeft:t,dialogClass:"scrappy-dialog"}),n.rotateDialog.attachEvents({":select":function(t,r){n.rotateDialog.switchToLocked(!1),t.target.ancestor(".c-rotations").all("img").removeClass("c-state-selected"),t.target.addClass("c-state-selected"),n._imgRotation=e.flutil.constrainToValues(r.rotation,["90","180","270"])},":submit":function(){n.rotateSubmit()}}),n.rotateDialog.on("hide",function(){n.rotateDialog.destroy(),n.rotateDialog=null}),n.rotateDialog.set("preview",n.get("photo").getSizeToFit({width:r,height:r})),n.rotateDialog.switchToLocked(),n.rotateDialog.show()}),e.rapidTracker.beacon(this.name,"rotatePhotoClick")},rotateSubmit:function(){var t=this;t.rotateDialog.get("container").one(".ui-dialog-buttonbar").addClass("loading").append(t.templates("flickr-balls")({})),e.rapidTracker.beacon(this.name,"rotatePhotoConfirmationClick"),this.appContext.callAPI("flickr.photos.transform.rotate",{photo_id:this.photoId,degrees:this._imgRotation}).then(function(){setTimeout(function(){t.rotateDialog.close(),t.fire("subviewViewEvent","photo:reload")},2e3)},function(n){t.rotateDialog.get("container").one(".ui-dialog-buttonbar").removeClass("loading"),t.rotateDialog.close(),t.showErrorDialog(t.intlMessage({intlName:"photo-page-scrappy.ERROR_ROTATING_PHOTO"})),e.Flog.error("[more-menu-view] photo-rotate: error during rotation ("+n.toString()+")")})},handleEditAviaryClick:function(t){var n;t.halt(),this.editMenu.hide(),n=this.subviews["feather-aviary-view"],n&&n.activate(),e.rapidTracker.beacon(this.name,"editAviary")},activate:function(){var e=this,t=this.get("container"),n,r={};return this.appContext.experiments.fullscreen.getMode()||(this.setupDropdown(),n=e.editMenu.get("container")),t&&this.registerEventHandler(t.on("click",e.handleMenuButtonClick,e)),this.appContext.experiments.fullscreen.getMode()||this.appContext.auth.signedIn&&(r.deleteMenuItem=n.one(".delete-photo"),r.deleteMenuItem&&r.deleteMenuItem.on("click",e.handleDeletePhotoClick,e),r.rotateMenuItem=n.one(".rotate-photo"),r.rotateMenuItem&&r.rotateMenuItem.on("click",e.handleRotatePhotoClick,e),r.replaceMenuItem=n.one(".replace-photo"),r.replaceMenuItem&&r.replaceMenuItem.on("click",e.handleReplacePhotoClick,e),r.aviaryMenuItem=n.one(".edit-aviary"),r.aviaryMenuItem&&r.aviaryMenuItem.on("click",e.handleEditAviaryClick,e)),this},showErrorDialog:function(t){return this.errorDialog=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,darkOverlay:!0}),this.errorDialog.show(),this.errorDialog}})},"@VERSION@",{requires:["flickr-view","flog","dialog","flutil","hermes-template-dialog-cta-reboot","flickr-promise","more-menu-css","feather-aviary-view","confirmation-dialog-view","hermes-template-scrappy-edit-button","hermes-template-scrappy-edit-menu","hermes-template-delete-photo-dialog-content","hermes-template-replace-photo-dialog-content","hermes-template-rotate-photo-dialog-content","photo-well-scrappy-edit-view-css","hermes-template-flickr-balls","fluid-balls-css"],optional:[],langBundles:["common","photo-page-scrappy","aviary"]});
