YUI.add("flickr-products-wallart-fetcher",function(e,t){"use strict";function n(t){var n={wallart_id:t.id,return_deleted:1,extras:e.APIHelper.request.getRebootPhotoExtras()};return n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=r.wallart,c,h,p,d,v=!1,m=!1,g={};if(l)return p=s.addOrUpdate({id:l.owner}),g={photos:[l.photo],personModelRegistry:s,photoModelRegistry:o,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f},l.photo.ownerId&&(g.ownerID=l.photo.ownerId),h=e.APIHelper.response.parsePhotos(g)[0],l.skuId.substr(-2)==="CC"?(d=l.skuId.slice(0,-3),v=!0):l.skuId.substr(-2)==="MK"?(d=l.skuId.slice(0,-3),m=!0):d=l.skuId,c={id:l.wallartId,owner:p,photo:h,skuId:d,isCC:v,isMK:m,orientation:l.orientation,price:l.price,cropW:l.photo.cropW,cropH:l.photo.cropH,cropX:l.photo.cropX,cropY:l.photo.cropY,isEditable:l.isEditable,isDeleted:l.isDeleted,isLowQuality:l.isLowQuality,photoSource:l.photoSource,created:l.dateCreate},i.addOrUpdate(c),c}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.products.wallart.getDetails",this._processParams(n)),r.getModelRegistry("wallart-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-products-wallart"]={run:i,_processResponse:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["wallart-models","photo-models","person-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("photo-engagement-view",function(e,t){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.nsid=e.nsid,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.signinPendingQueue=e.signinPendingQueue,this},subviewConfig:{"fave-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,hideWhoFaved:!0},"photo-well-scrappy-edit-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-share-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"vr-engagement-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-vr")}}},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){var e,t=this.get("photo"),n=t.getValue("owner"),r;return r={"photo-well-scrappy-edit-view":this.subviews["photo-well-scrappy-edit-view"].get("container"),"fave-view":this.subviews["fave-view"].get("container"),"share-view":this.subviews["fluid-share-photo-view"]?this.subviews["fluid-share-photo-view"].get("container"):"",photoId:t.getValue("id"),isVideo:t.getValue("isVideo"),viewerIsOwner:n.getValue("isMe"),canCreateWallart:this.canCreateWallart(),isWallartLowQuality:this.isWallartLowQuality(),downloadingAvailable:!1,downloadLink:""},this.subviews["vr-engagement-view"]&&(r["vr-engagement-view"]=this.subviews["vr-engagement-view"].get("container")),t.getValue("isVideo")?(r.downloadLink="/video_download.gne?id="+t.getValue("id"),this.appContext.flipper.isFlipped("enable-album-download")&&(r.downloadingAvailable=t.getValue("engagement").getValue("canDownload")),n.getValue("isMe")&&(r.downloadingAvailable=!0)):(r.downloadLink=t.getValue("url")+"/sizes/l/",r.downloadingAvailable=!0),this.appContext.forceServerRender&&(r.downloadItems=this.getDownloadMenuItems()),e=this.templates("photo-engagement")(r),this.setContainerHTML(e),r.canCreateWallart&&this.get("container").addClass("has-wallart"),this.subviews["vr-engagement-view"]&&this.subviews["vr-engagement-view"].get("canVr")&&this.get("container").addClass("has-vr"),this},buildErrorContainer:function(){this.setContainerHTML("")},activate:function(){var e=this.get("photo").getValue("license"),t=e!==0&&e!==7&&e!==8&&e!==10,n=e===9,r=e===10,i=this.get("container");if(this.signinPendingQueue&&this.signinPendingQueue.length>0){var s=this.signinPendingQueue;for(var o=0;o<s.length;o++)s[o].key==="download"&&s[o].value&&s[o].value.id===this.photoId&&this.downloadItem(s[o].value.imageUrl)}return this.appContext.flipper.isFlipped("enable-signed-out-download-cta-test")&&!this.appContext.getViewer().signedIn&&!this.appContext.getUA().isBot&&this.get("photo").getValue("owner").getValue("isPro")!==!0&&!t&&!n&&!r&&this.get("photo").getValue("visibilitySource")!==2&&(this.signedOutTest=!0),this.createDownloadDialog(this.getDownloadMenuItems()),this.registerEventHandler(i.all(".sizes li a.download-image-size").on("click",this.handleDownloadItemClick,this)),this.attachKeyEvent("down:68",this.handleDownloadMenuButtonClick.bind(this)),this.registerEventHandler(i.delegate("click",this.handleDownloadMenuButtonClick.bind(this),".download a")),this.registerEventHandler(i.delegate("click",this.createWallartClick.bind(this),".wallart a")),this.registerEventHandler(this.get("photo").on("valuesChanged",function(e){e.isMarketplacePrintable&&e.isMarketplacePrintable.newVal===!0&&(this.buildContainer(),this.getDownloadMenuItems(),this.get("container").all(".sizes li a.download-image-size").on("click",this.handleDownloadItemClick,this))}.bind(this))),this.signedOutTest&&this.registerEventHandler(i.one(".all-sizes").on("click",function(e){e.halt(),this.signUpAndDownloadItem()}.bind(this))),this},canCreateWallart:function(){var e=!1,t,n=this.appContext.getViewer(),r,i,s,o,u;return t=this.get("photo"),t&&n&&(i=!1,r=t.getValue("owner").getValue("isMe"),s=t.getValue("isMarketplacePrintable"),u=t.getValue("safetyLevel")===0,o=!t.getValue("isVideo"),this.appContext.flipper.isFlipped("creative-commons-wallart")?r?this.appContext.getViewer().signedIn&&o&&(e=!0):i?this.appContext.getViewer().signedIn&&o&&u&&(e=!0):s&&this.appContext.getViewer().signedIn&&o&&u&&(e=!0):this.appContext.getViewer().signedIn&&r&&o&&(e=!0)),e},isWallartLowQuality:function(){var t=this.get("photo");return this.wallartHelper||(this.wallartHelper=new e.WallartHelper),this.wallartHelper.isPhotoWallartable(t).skus.length===0?!0:!1},createWallartClick:function(n){var r=this,i="/create/wallart/",s=this.get("photo"),o;n.halt(),e.rapidTracker.beacon(t,"createWallartClick");if(s.getValue("hasInvalidColorspaceForPrint"))return this.handleLacksWallartability("COLORSPACE");this.wallartHelper||(this.wallartHelper=new e.WallartHelper(this.appContext));if(this.wallartHelper.isPhotoWallartable(s).skus.length===0)return this.handleLacksWallartability("LOW_QUALITY");this.appContext.getModelRegistry("wallart-models").then(function(t){t.remoteCreate({nsid:r.appContext.getViewer().nsid,photoId:s.getValue("id")}).then(function(t){i+=t.getValue("id")+"/edit",YUI.Env.isServer||(!r.appContext.secure&&window.location.host===e.config.flickr.url.host?e.config.win.location.href=i:r.appContext.flapp.navigate(i))},function(t){o=new e.Views.FluidModal({appContext:r.appContext,darkOverlay:!0,dismissOnOverlayClick:!0,actionButtonLabel:r.intlMessage({intlName:"common.OK"}),title:r.intlMessage({intlName:"common.UPLOAD_ERROR_TITLE"}),message:"There was a problem creating your wall art. Please try again later."}),o.show(),e.Flog.warn("uh oh spaghettios")})})},handleLacksWallartability:function(t){var n,r;t==="LOW_QUALITY"?r="Looks like this photo doesn't meet the minimum requirements to get printed. Please choose a photo that's at least 975 &times; 825 pixels. Learn more about <a href='http://help.yahoo.com/kb/index?page=content&y=PROD_FLICKR&locale=en_US&id=SLN22567'>requirements</a> for print products."
:t==="COLORSPACE"&&(r="Sorry, we cannot print photos with a CMYK or ProPhoto RGB colorspace. We recommend photos with an sRGB color space. <a href='https://help.yahoo.com/kb/flickr/creations-faq-sln22216.html?impressions=true#cont33'>Learn more</a>."),n=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,showCancelX:!0,title:"Try a different photo",message:r,classList:"lacks-wallartability"}),n.show()},getDownloadMenuItems:function(t){var n=e.clone(this.get("photo").toJSON()),r,i=[],s,o=this.get("photo").getValue("engagement").getValue("canDownload"),u=!1;n.sizes.q&&(n.sizes.q.label=this.intlMessage({intlName:"photo-page-scrappy.SQUARE"}),i.push(n.sizes.q)),n.sizes.s&&(n.sizes.s.label=this.intlMessage({intlName:"photo-page-scrappy.SMALL"}),i.push(n.sizes.s)),n.sizes.z&&(n.sizes.z.label=this.intlMessage({intlName:"photo-page-scrappy.MEDIUM"}),i.push(n.sizes.z)),n.sizes.k?(n.sizes.k.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),i.push(n.sizes.k)):n.sizes.h?(n.sizes.h.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),i.push(n.sizes.h)):n.sizes.l&&(n.sizes.l.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),i.push(n.sizes.l)),n.sizes.o&&(n.sizes.o.label=this.intlMessage({intlName:"photo-page-scrappy.ORIGINAL"}),i.push(n.sizes.o));for(s=0;s<i.length;s++)i[s].url=i[s].displayUrl.replace(/^(.+)(\..+)$/,"$1_d$2");return o&&(u=!0),r=this.templates("scrappy-download-menu")({photo:n,sizes:i,showDownloadSizes:u}),r},createDownloadDialog:function(t){var n=this.get("container"),r=this;this.downloadMenu=e.Views.dialog.getNewInstance("dialog-tooltip",{content:t,anchorTo:n.one(".download"),dropUp:!0,parent:this,positioning:!1,rootEl:n}),this.downloadMenu.render(),this.downloadMenu.on("toggle",function(e){e&&e.details&&e.details.length>0&&(e.details[0]?r.fire("subviewViewEvent","make in view",n):r.fire("subviewViewEvent","close in view"))})},handleDownloadMenuButtonClick:function(n){var r=this.get("photo"),i;n.target.ancestor(".download",!0).hasClass("disabled")&&n.preventDefault();if(r.getValue("isVideo")){if(!this.appContext.flipper.isFlipped("enable-album-download")){i=r.getValue("owner").getValue("isMe");if(!i)return n.preventDefault(),!1}}else n.halt(),this.downloadMenu.toggle();e.rapidTracker.beacon(t,"downloadDialogClick")},handleDownloadItemClick:function(n){n.preventDefault();var r;r=n.currentTarget.getAttribute("href"),this.signedOutTest?this.signUpAndDownloadItem(r):this.downloadItem(r),e.rapidTracker.beacon(t,"photoDownloadClick"),this.downloadMenu.hide()},downloadItem:function(e){document.location=e},signUpAndDownloadItem:function(t){var n=this,r=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_DOWNLOAD_TITLE"}),i=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_DOWNLOAD_MESSAGE"}),s,o;s=e.url(e.URLHelper.getPhotoPage({photoId:this.photoId,pathAlias:this.nsid})),o=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-download",signUpTitle:r,signUpMessage:i,beaconPrefix:"download"}),o.on("signUpClick",function(r){t?e.SigninHelper.signUpPendingDownload({id:n.photoId,imageUrl:t},{postLoginUrl:s}):e.SigninHelper._redirectToSignUp("download",{postLoginUrl:s+"sizes/l/"})}),o.on("signInClick",function(r){t?e.SigninHelper.addPendingDownload({id:n.photoId,imageUrl:t},{postLoginUrl:s}):e.SigninHelper._redirectToSignin("download",{postLoginUrl:s+"sizes/l/"})}),o.show()}})},"@VERSION@",{requires:["flickr-view","flog","hermes-template-photo-engagement","hermes-template-download-dialog","hermes-template-scrappy-download-menu","wallart-helper","photo-engagement-css","signup-modal-view","fluid-share-photo-view","vr-engagement-view","better-throttle"],optional:["photo-models","wallart-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("seo",function(e,t){e.Seo={appContext:{},getSEOTitleForPhoto:function(e,t,n,r){var i=e.getValue("og:title"),s=e.getValue("og:description"),o="",u="| Flickr",a=70,f=a-(i.length+u.length+5);return i==="Untitled"&&(i=r),i.length>50?o=i.slice(0,58)+(i.length<58?" ":"\u2026 "):i.length>20&&i.length<50?s.length>20?o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 "):o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 ")+"| "+n+" ":i.length<=20&&(s.length>50?o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 "):o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 ")+"| "+n+" "),o},generateSEODescriptionForPhoto:function(e,t,n,r,i){var s=e.getValue("og:title"),o=e.getValue("og:description"),u="",a=160;return s==="Untitled"&&(s=r),o.length>120?u=o.slice(0,120)+(o.length<120?" ":"\u2026 ")+n+" "+i+".":o.length>60&&o.length<120?u=o+(o.slice(o.length-1,o.length)==="."?" ":". ")+s.slice(0,40)+(s.length<40?" ":"\u2026 ")+n+" "+i+".":o.length<=60&&(u=s+(s.slice(s.length-1,s.length)==="."?" ":". ")+o.slice(0,a-s.length)+(o.length<a-s.length?" ":"\u2026 ")+n+" "+i+"."),u}}},"@VERSION@",{requires:[]});
YUI.add("hermes-template-photo-page-lightbox",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-well-view"],u):a.call(t,"outlet",t["photo-well-view"],u)))+"\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-page-lightbox",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return" no-click"}function d(e,t){return" is-hidden"}function v(e,t){return" is-video"}function m(e,t){var r;return(r=n["prev-url"])?r=r.call(e,{hash:{},data:t}):(r=e["prev-url"],r=typeof r===f?r.apply(e):r),l(r)}function g(e,t){return"#"}function y(e,t){var r;return(r=n["prev-title"])?r=r.call(e,{hash:{},data:t}):(r=e["prev-title"],r=typeof r===f?r.apply(e):r),l(r)}function b(e,t){var r;return(r=n["next-url"])?r=r.call(e,{hash:{},data:t}):(r=e["next-url"],r=typeof r===f?r.apply(e):r),l(r)}function w(e,t){var r;return(r=n["next-title"])?r=r.call(e,{hash:{},data:t}):(r=e["next-title"],r=typeof r===f?r.apply(e):r),l(r)}function E(e,t){var r="",i,s;r+="\n	",i=n["if"].call(e,e["opt-out-enabled"],{hash:{},inverse:c.noop,fn:c.program(18,S,t),data:t});if(i||i===0)r+=i;return r+="\n\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-sidebar-toggle-view"],s):h.call(e,"outlet",e["photo-sidebar-toggle-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-title-desc-overlay-view"],s):h.call(e,"outlet",e["photo-title-desc-overlay-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-sidebar-actions-view"],s):h.call(e,"outlet",e["photo-sidebar-actions-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["attribution-view"],s):h.call(e,"outlet",e["attribution-view"],s)))+"\n",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["people-notes-view"],s):h.call(e,"outlet",e["people-notes-view"],s)))+"\n\n",r}function S(e,t){return'\n	<div class="feedback-widget">\n		<button class="ui-button ui-button-cta ui-button-transparent"><span>Opt-out &amp; Feedback</span></button>\n	</div>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<a class="navigate-target navigate-prev',o=n["if"].call(t,t["prev-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(o||o===0)s+=o;s+='" href="',o=n["if"].call(t,t["prev-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(7,m,i),data:i});if(o||o===0)s+=o;s+='" title="',o=n["if"].call(t,t["prev-url"],{hash:{},inverse:c.noop,fn:c.program(11,y,i),data:i});if(o||o===0)s+=o;s+='"  data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-prev',o=n["if"].call(t,t["prev-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(o||o===0)s+=o;s+='" href="',o=n["if"].call(t,t["prev-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(7,m,i),data:i});if(o||o===0)s+=o;s+='" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&larr;</span></a>\n\n',a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["photo-well-media-view"],a):h.call(t,"outlet",t["photo-well-media-view"],a)))+'\n\n<a class="navigate-target navigate-next',u=n["if"].call(t,t["next-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(u||u===0)s+=u;s+='" href="',u=n["if"].call(t,t["next-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(13,b,i),data:i});if(u||u===0)s+=u;s+='" title="',u=n["if"].call(t,t["next-url"],{hash:{},inverse:c.noop,fn:c.program(15,w,i),data:i});if(u||u===0)s+=u;s+='" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-next',u=n["if"].call(t,t["next-is-not-clickable"],{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-hidden"],{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-video"],{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(u||u===0)s+=u;s+='" href="',u=n["if"].call(t,t["next-url"],{hash:{},inverse:c.program(9,g,i),fn:c.program(13,b,i),data:i});if(u||u===0)s+=u;s+='" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\n',u=n.unless.call(t,t["is-ad"],{hash:{},inverse:c.noop,fn:c.program(17,E,i),data:i});if(u||u===0)s+=u;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-reboot-welcome-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function a(e,t){return"\n	While we continue to develop the beta experience, we want your feedback. In case you need some of the missing functionality, you can easily opt-out and go back to the old experience.\n"}function f(e,t){return"\n	Please continue providing us with feedback so we can continue to improve Flickr.\n"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this;s+="Flickr is about the amazing photos you capture and the communities that you build around these photos. The goal of our photo page redesign is to provide you with a fast photo browsing experience and an easy interface to build &amp; maintain relationships.<br>\n<br>\nOver the last 4 weeks, we received a lot of feedback from the Flickr community regarding the photo page design. Based on the feedback, we are experimenting with different variations of the photo page to identify the best experience.<br>\n<br>\n",o=n["if"].call(t,t["opt-out-enabled"],{hash:{},inverse:u.program(3,f,i),fn:u.program(1,a,i),data:i});if(o||o===0)s+=o;return s+="\n<br>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/reboot-welcome-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-opt-out",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<form action="//',(o=n.host)?o=o.call(t,{hash:{},data:i}):(o=t.host,o=typeof o===u?o.apply(t):o),s+=a(o)+'/help/optin" method="post">\n	<input type="hidden" name="photo_opt" value="0">\n	<input type="hidden" name="redirect_url" value="',(o=n["redirect-url"])?o=o.call(t,{hash:{},data:i}):(o=t["redirect-url"],o=typeof o===u?o.apply(t):o),s+=a(o)+'">\n	<input type="submit" class="ui-button" value="Go back to the old experience">\n</form>',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-opt-out",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well-media",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i,s,o;r+='\n	<div class="restricted-interstitial">\n		<div class="restricted-interstitial-message">\n			<h2>',o={hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+"</h2>\n			",s=n["if"].call(e,e.isSignedIn,{hash:{},inverse:l.program(4,p,t),fn:l.program(2,h,t),data:t});if(s||s===0)r+=s;return r+="\n		</div>\n	</div>\n",r}function h(e,t){var r="",i,s;return r+="\n				<p>",s={hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"<br />",s={hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"</p>\n				<p><button class='ui-button'><span>",s={hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"</span></button></p>\n				<p>",s={hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:t},r+=a((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):u.call(e,"intlHTMLMessage",s)))+"</p>\n			",r}function p(e,t){var r="",i,s,o;return r+="\n				<p>",o={hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+' <a href="//',(s=n.host)?s=s.call(e,{hash:{},data:t}):(s=e.host,s=typeof s===f?s.apply(e):s),r+=a(s)+'/signin/" data-track="photoWellSignInClick">',o={hash:{intlName:"common.SIGN_IN"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+"</a></p>\n			",r}function d(e,t){var r="",i;r+="\n\n	",i=n["if"].call(e,e.isAd,{hash:{},inverse:l.noop,fn:l.program(7,v,t),data:t});if(i||i===0)r+=i;r+="\n		",i=n["if"].call(e,e.isVideo,{hash:{},inverse:l.program(11,g,t),fn:l.program(9,m,t),data:t});if(i||i===0)r+=i;r+="\n	",i=n["if"].call(e,e.isAd,{hash:{},inverse:l.noop,fn:l.program(14,b,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function v(e,t){var n="",r;return n+='\n		<a class="ad-wrapper" href="'+a((r=(r=e.ad,r==null||r===!1?r:r.clickUrl),typeof r===f?r.apply(e):r))+'">\n	',n}function m(e,t){var r="",i;return r+='\n			<div class="videoplayer main-photo" style="width:',(i=n.width)?i=i.call(e,{hash:{},data:t}):(i=e.width,i=typeof i===f?i.apply(e):i),r+=a(i)+"px; height:",(i=n.height)?i=i.call(e,{hash:{},data:t}):(i=e.height,i=typeof i===f?i.apply(e):i),r+=a(i)+'px;"></div>\n		',r}function g(e,t){var r="",i,s,o;r+='\n\n			<div class="facade-of-protection-neue ',i=n["if"].call(e,e["is-video"],{hash:{},inverse:l.noop,fn:l.program(12,y,t),data:t});if(i||i===0)r+=i;return r+='">\n				',o={hash:{},data:t},r+=a((i=n.outlet||e.outlet,i?i.call(e,e["zoom-view"],o):u.call(e,"outlet",e["zoom-view"],o)))+'\n			</div>\n\n			<img width="',(s=n.width)?s=s.call(e,{hash:{},data:t}):(s=e.width,s=typeof s===f?s.apply(e):s),r+=a(s)+'" height="',(s=n.height)?s=s.call(e,{hash:{},data:t}):(s=e.height,s=typeof s===f?s.apply(e):s),r+=a(s)+'" src="',(s=n.src)?s=s.call(e,{hash:{},data:t}):(s=e.src,s=typeof s===f?s.apply(e):s),r+=a(s)+'" class="low-res-photo" alt="',(s=n.imgAltText)?s=s.call(e,{hash:{},data:t}):(s=e.imgAltText,s=typeof s===f?s.apply(e):s),r+=a(s)+'">\n			<img width="',(s=n.width)?s=s.call(e,{hash:{},data:t}):(s=e.width,s=typeof s===f?s.apply(e):s),r+=a(s)+'" height="',(s=n.height)?s=s.call(e,{hash:{},data:t}):(s=e.height,s=typeof s===f?s.apply(e):s),r+=a(s)+'" src="',(s=n.highResSrc)?s=s.call(e,{hash:{},data:t}):(s=e.highResSrc,s=typeof s===f?s.apply(e):s),r+=a(s)+'" class="main-photo is-hidden" onload="registerFirstPhoto(this)" alt="',(s=n.imgAltText)?s=s.call(e,{hash:{},data:t}):(s=e.imgAltText,s=typeof s===f?s.apply(e):s),r+=a(s)+'">\n			<noscript>\n				<img width="',(s=n.width)?s=s.call(e,{hash:{},data:t}):(s=e.width,s=typeof s===f?s.apply(e):s),r+=a(s)+'" height="',(s=n.height)?s=s.call(e,{hash:{},data:t}):(s=e.height,s=typeof s===f?s.apply(e):s),r+=a(s)+'" src="',(s=n.highResSrc)?s=s.call(e,{hash:{},data:t}):(s=e.highResSrc,s=typeof s===f?s.apply(e):s),r+=a(s)+'" class="main-photo" alt="',(s=n.imgAltText)?s=s.call(e,{hash:{},data:t}):(s=e.imgAltText,s=typeof s===f?s.apply(e):s),r+=a(s)+'">\n			</noscript>\n		',r}function y(e,t){return"is-video"}function b(e,t){var r="",i,s;return r+='\n			<span class="ad-info">',s={hash:{intlName:"photo-page-scrappy.FIND_OUT_MORE_AD",brand:(i=e.ad,i==null||i===!1?i:i.brand)},data:t},r+=a((i=n.intlHTMLMessage||e.intlHTMLMessage,i?i.call(e,s):u.call(e,"intlHTMLMessage",s)))+"</span>\n		</a>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;o=n["if"].call(t,t.needsInterstitial,{hash:{},inverse:l.program(6,d,i),fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;return s+="\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well-media",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-well-media-view",function(e){var t=500,n=500,r=100,i;i={photo:{render:function(){var t=this,n,i=this.get("photo"),s,o,u=new Date,a="";return t.preloadImage&&(t.preloadImage.onload=null),s=this.getPhotoForDisplay(),o=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]}),i.getValue("owner")&&(i.getValue("title").trim()===""?a=this.intlMessage({intlName:"common.UNTITLED"}):a=i.getValue("title"),a+=" | "+this.intlMessage({intlName:"common.BY_USER",user:i.getValue("owner").getValue("username")})),n=this.templates("photo-well-media")({width:s.width,height:s.height,src:o.url,highResSrc:s.url,imgAltText:a,needsInterstitial:i.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:i.getValue("isVideo"),isAd:this.isAd,"zoom-view":this.subviews["zoom-view"]?this.subviews["zoom-view"].get("container"):""}),this.setContainerHTML(n),this.fire("subviewViewEvent",s),YUI.Env.isServer?(this.serverWidth=s.width,this.serverHeight=s.height):i.getValue("needsInterstitial")||(t.preloadImage=new Image,t.preloadImage.onload=function(){if(this.onloadFired)return;if(!t.isActiveAndInDOM())return;this.onloadFired=!0,e.rapidTracker.beacon(this.name,"photoPageShowedSize"+(/(?:_([a-z]))?\.jpg/.exec(s.url)[1]||"\u00f8").toUpperCase());var n=t.get("container").one(".low-res-photo"),i=t.get("container").one(".main-photo"),o=new Date-u,a;o<r?(i.removeClass("is-hidden").show(),n.hide()):(i.setStyles({position:"absolute",left:0,top:0,opacity:0}),i.removeClass("is-hidden"),a=function(){i.removeAttribute("style"),n.hide()},e.UA.ie?a():e.use("transition",function(e){i.transition({duration:.25,opacity:1},a)}))},t.preloadImage.src=s.url,t.preloadImage.complete&&t.preloadImage.onload()),this}},video:{render:function(){var t,n=this,r=this.get("photo"),i=this.getPhotoForDisplay({excludeSizes:[]});return this.player?(this.player.resize(i.width,i.height),this):(t=this.templates("photo-well-media")({width:i.width,height:i.height,src:i.url,needsInterstitial:r.getValue("needsInterstitial"),isVideo:r.getValue("isVideo"),isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this.setContainerHTML(t),this.fire("subviewViewEvent",i),YUI.Env.isServer?this:(this.player=new e.FlickrVideoPlayer({container:this.get("container").one(".videoplayer"),model:r,appContext:this.appContext}),n.player.init().then(function(){n}),this.on("destroy",function(){n.player.destroy(),n.player=null}),this))}},ad:{render:function(){var e,t,n;return this.adJSON?t=this.adJSON:(t=this.appContext.adManager.getAdJSON(),this.adJSON=t),n=this.getAdSize(t),e=this.templates("photo-well-ad")({width:n.width,height:n.height,src:t.url,clickUrl:t.clickUrl,brand:t.brand,adsTypeB:this.appContext.flipper.isFlipped("moneyball-ads-type-b")}),this.setContainerHTML(e),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-scrappy-zoom")},disableIfSmall:!0}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.ad=e.ad,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?i.ad.render.call(this):i[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this),this},handleInterstitialDismissButtonClick:function(t){var n=this,r=this.get("personPreferences"),i=this.get("photo"),s=i.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),r.setValue("safeSearch",s),r.registry.remoteUpdate(n.appContext.auth.user.nsid).then(function(e){var t=i.registry.attributeSearch({needsInterstitial:!0});t.forEach(function(e){i.registry.getValue(e,"safetyLevel")<=r.getValue("safeSearch")&&i.registry.setValue(e,"needsInterstitial",!1)}),n.buildContainer()},function(t){e.Flog.error(t.message),e.Flog.error(t.stack),n.onError(n.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},activate:function(){var t=this,n=this.getPhotoForDisplay(),r=this.get("container").one(".main-photo"),i,s;return this.get("photo").getValue("needsInterstitial")||(e.use("global-events",function(e){t.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()}))}),this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),!this.isAd&&(!t.get("clientRendered")||n.width!==Number(r.getAttribute("width"))||n.height!==Number(r.getAttribute("height")))&&t.buildContainer()),this.registerEventHandler(e.on("flickr:display-note-box",function(n){i=e.Node.create('<div class="note-box"></div>'),s=t.get("container").one(".main-photo").getXY(),t.get("container").append(i),i.setStyles({top:n.noteBoxTop+t.get("container").one(".main-photo").getDOMNode().offsetTop,left:n.noteBoxLeft,width:n.noteBoxWidth,height:n.noteBoxHeight})})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this},onError:function(t){var n=this;this.fire("subviewViewEvent","getDialogOffset",function(r){var i=e.Views.dialog.getInstance("dialog-alert",{content:t,attrs:{title:n.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:n.intlMessage({intlName:"common.OK"})},parent:n,offsetLeft:r});i.show()})},getPhotoForDisplay:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=this.get("photo").getSizeToFit(t,e),i,s;return i=Math.min(t.height/n,r.height),s=Math.min
(t.width/n,r.width/r.height*i),i=Math.min(i,r.height/r.width*s),{width:Math.round(s),height:Math.round(i),url:r.url,pixelRatio:r.width/s}},getAdSize:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=80,i=140,s,o;return this.appContext.flipper.isFlipped("moneyball-ads-type-b")&&(t.height-=(r+i)*n,t.width-=i*n),s=Math.min(t.height/n,e.height),o=Math.min(t.width/n,e.width/e.height*s),s=Math.min(s,e.height/e.width*o),{width:o,height:s}},getCanvasSize:function(){var e,r=this.getPixelRatio(),i;return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(i=this.get("container").ancestor(),i&&(e=i.get("region"),e.width>0&&e.height>0&&(this.set("canvasSizeIsDirty",!1),this.set("cachedCanvasSize",e),this.appContext.setCookie({remove:!0,cookieName:"photoPW",path:"/photos/",cookieValue:e.width}),this.appContext.setCookie({remove:!0,cookieName:"photoPH",path:"/photos/",cookieValue:e.height}),this.appContext.setCookie({remove:!0,cookieName:"density",path:"/photos/",cookieValue:r})))):e=this.get("cachedCanvasSize"),e||(e={top:0,left:0,bottom:n,right:t,width:parseInt(this.appContext.getCookie("photoPW"),10)||t,height:parseInt(this.appContext.getCookie("photoPH"),10)||n}),e.height*=r,e.width*=r,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flog","flickr-view","hermes-template-photo-well-media","moment","flickr-video-player","hermes-template-photo-well-ad","zoom-view"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-lang-attribution_zh-hant-hk",function(e,t){e.Intl.add("hermes/attribution","zh-Hant-HK",{FOLLOW:["\u8ffd\u8e64"],FOLLOWING:["\u6b63\u5728\u8ffd\u8e64"],ERROR_SETTING_FRIEND:["\u8a2d\u5b9a\u670b\u53cb\u95dc\u4fc2\u6642\u767c\u751f\u554f\u984c"],ERROR_SETTING_FAMILY:["\u8a2d\u5b9a\u670b\u53cb\u95dc\u4fc2\u6642\u767c\u751f ",{type:"number",valueName:"POPULATION",format:"integer"}," \u554f\u984c"],FRIEND:["\u670b\u53cb"],FAMILY:["\u5bb6\u4eba"],UNFOLLOW:["\u53d6\u6d88\u8ffd\u8e64"],GO_TO_PHOTOSTREAM:["\u79fb\u81f3 ","${name}"," \u7684\u6240\u6709\u76f8\u7247"],BY_USER:["\u76f8\u7247\u64c1\u6709\u8005\uff1a","${user}"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-head-meta",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function d(e,t){return'name="'}function v(e,t){return'property="'}function m(e,t){var n="";return n+='description="'+l(typeof e===f?e.apply(e):e)+'"',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing,p=n.blockHelperMissing;s+="<meta ",o=n["if"].call(t,t.isName,{hash:{},inverse:c.program(3,v,i),fn:c.program(1,d,i),data:i});if(o||o===0)s+=o;(o=n.metaName)?o=o.call(t,{hash:{},data:i}):(o=t.metaName,o=typeof o===f?o.apply(t):o),s+=l(o)+'" content="',a={hash:{},data:i},s+=l((o=n.renderMetaInfo||t.renderMetaInfo,o?o.call(t,t.metaValue,a):h.call(t,"renderMetaInfo",t.metaValue,a)))+'" ',a={hash:{},inverse:c.noop,fn:c.program(5,m,i),data:i},(u=n.metaDescription)?u=u.call(t,a):(u=t.metaDescription,u=typeof u===f?u.apply(t):u),n.metaDescription||(u=p.call(t,u,a));if(u||u===0)s+=u;return s+=' data-dynamic="true">\n',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-meta",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-head-link",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i;return r+='id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function h(e,t){var r="",i;return r+='rev="',(i=n.rev)?i=i.call(e,{hash:{},data:t}):(i=e.rev,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function p(e,t){var r="",i;return r+='rel="',(i=n.rel)?i=i.call(e,{hash:{},data:t}):(i=e.rel,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function d(e,t){var r="",i;return r+='type="',(i=n.type)?i=i.call(e,{hash:{},data:t}):(i=e.type,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function v(e,t){var r="",i;return r+='media="',(i=n.media)?i=i.call(e,{hash:{},data:t}):(i=e.media,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function m(e,t){var r="",i;return r+='href="',(i=n.href)?i=i.call(e,{hash:{},data:t}):(i=e.href,i=typeof i===u?i.apply(e):i),r+=a(i)+'"',r}function g(e,t){var r="",i,s;return r+='data-dynamic-added-by="',s={hash:{},data:t},r+=a((i=n.obfuscateInternals||e.obfuscateInternals,i?i.call(e,e.addedBy,s):f.call(e,"obfuscateInternals",e.addedBy,s)))+'"',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+="<link ",o=n["if"].call(t,t.id,{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.rev,{hash:{},inverse:l.noop,fn:l.program(3,h,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.rel,{hash:{},inverse:l.noop,fn:l.program(5,p,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.type,{hash:{},inverse:l.noop,fn:l.program(7,d,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.media,{hash:{},inverse:l.noop,fn:l.program(9,v,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.href,{hash:{},inverse:l.noop,fn:l.program(11,m,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t.addedBy,{hash:{},inverse:l.noop,fn:l.program(13,g,i),data:i});if(o||o===0)s+=o;return s+=' data-dynamic="true" />',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-link",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-head-meta-view",function(e){var t=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{},buildContainer:function(){return this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("photo-head-meta-models",t._params.photoId),t.appContext.getModel("photo-models",t._params.photoId),t.appContext.getModel("photo-privacy-models",t._params.photoId)]).then(function(e){t.set("photo-meta",e[0]),t.set("photo",e[1]),t.set("photo-privacy",e[2])})},buildHeadContainer:function(){var t=this.get("photo-meta"),n=this.get("photo"),r=this.get("photo-privacy"),i=e.url(),s=t.getFieldsForDisplay(),o="",u=this,a=[{id:"canonicalurl",rel:"canonical",href:i+n.getValue("url")},{rel:"alternative",type:"application/json+oembed",href:i+"/services/oembed?url="+encodeURI(i+n.getValue("url"))+"&format=json",title:n.getValue("title")},{rel:"alternative",type:"text/xml+oembed",href:i+"/services/oembed?url="+encodeURI(i+n.getValue("url"))+"&format=xml",title:n.getValue("title")},{rel:"alternative",media:"only screen and (max-width: 640px)",href:"https://m.flickr.com"+encodeURI(n.getValue("url")+"/")}];s["al:ios:url"]||(s["al:ios:url"]="flickr://flickr.com"+n.getValue("url")),o+=this.templates("head-meta")({isName:!0,metaName:"description",metaValue:n.getValue("description")||n.getValue("title")})+"\n";var f="noarchive";return r.getValue("isPublic")||(f+=", noindex"),o+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:f}),o+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:f}),Object.keys(s).forEach(function(e){typeof s[e]=="object"&&e==="pinterest"?o+=u.templates("head-meta")({metaName:e,noPin:!0,metaValue:s[e].nopin,metaDescription:s[e].reason,isName:!0})+"\n":e==="og:description"?o+=u.templates("head-meta")({metaName:e,metaValue:s[e]})+"\n":e==="title"?o+=u.templates("head-meta")({isName:!0,metaName:"title",metaValue:s[e]})+"\n":e==="keywords"?o+=u.templates("head-meta")({isName:!0,metaName:e,metaValue:s[e]})+"\n":e==="noindexfollow"?s[e]&&(s[e]>0||s[e]!=="")&&(o+=u.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noindex,follow"})+"\n",o+=u.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noindex,follow"})+"\n"):o+=u.templates("head-meta")({metaName:e,metaValue:s[e]})+"\n"}),a.forEach(function(e){e.addedBy=u.name,o+=u.templates("head-link")(e)+"\n"}),this.set("headContainer",o),YUI.Env.isServer||this.updateHead(),this}});return e.mix(t.prototype,e.Seo),t},"@VERSION@",{requires:["flickr-view","hermes-template-head-meta","hermes-template-head-link"],optional:["photo-head-meta-models","photo-route","url","seo"],langBundles:["meta","common","attribution","share-modal"]});
YUI.add("hermes-lang-meta_zh-hant-hk",function(e,t){e.Intl.add("hermes/meta","zh-Hant-HK",{PHOTOSTREAM:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u7684 ",{type:"plural",valueName:"photoCount",options:{one:"\u5f35\u76f8\u7247\uff01",other:"${#} \u5f35\u76f8\u7247\uff01"}}],PHOTOSTREAM_NO_PHOTOS:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u7684\u76f8\u7247\uff01"],ALBUMS_LIST:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u7684 ",{type:"plural",valueName:"photoCount",options:{one:"\u500b\u76f8\u7c3f\uff01",other:"${#} \u500b\u76f8\u7c3f\uff01"}}],ALBUMS_LIST_NO_ALBUMS:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u7684\u76f8\u7c3f\uff01"],FAVORITES:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u7684 ",{type:"plural",valueName:"photoCount",options:{one:"\u5f35\u52a0\u5165\u6700\u611b\u7684\u76f8\u7247\uff01",other:"${#} \u5f35\u52a0\u5165\u6700\u611b\u7684\u76f8\u7247\uff01"}}],FAVORITES_NO_PHOTOS:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u52a0\u5165\u6700\u611b\u7684\u76f8\u7247\uff01"],META_DESCRIPTION_BY_USER_ON_FLICKR:["\u7531 ","${username}"," \u5728 Flickr\u00b7\u4e0a\u767c\u4f48"],PHOTOSTREAM_ATOM_TITLE:["Flickr\uff1a \u6709\u95dc ","${username}"," \u6240\u6709\u76f8\u7247\u7684 Atom Feed"],FAVORITES_ATOM_TITLE:["Flickr\uff1a \u6709\u95dc ","${username}"," \u6700\u611b\u7684 Atom Feed"],GROUP_POOL_ATOM_TITLE:["Flickr\uff1a \u6709\u95dc ","${groupName}"," \u76f8\u7247\u7684 Atom Feed"],GROUP_DISCUSSIONS_ATOM_TITLE:["Flickr\uff1a \u6709\u95dc ","${groupName}"," \u8a0e\u8ad6\u7684 Atom Feed"]})},"@VERSION@",{requires:["intl"]});
YUI.add("photo-page-lightbox-scrappy-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n=this;return this.backToURL=t.backToURL,this.entryTypeIntlKey=t.entryTypeIntlKey,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.appContext.experiments.fullscreen.enableFullscreen(),t.realFullscreen=!0,t.isOwner=this.isOwner,this.enableZoom=this.appContext.flipper.isFlipped("enable-scrappy-zoom"),this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext)),this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one("head title").set("text",n.intlMessage({intlName:"photo-page-scrappy.PAGE_TITLE",title:t.title.newVal}))})}),this},subviewConfig:{"photo-well-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,dealbreaker:!0},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},buildContainer:function(){var t,n=this.subviews["photo-well-view"].get("container");return n.addClass("scrappy-photo-page-enabled"),n.addClass("is-real-fullscreen"),this.enableZoom&&n.addClass("enable-zoom"),t=this.templates("photo-page-lightbox")({"photo-well-view":n}),this.setContainerHTML(t),e.fletrics.increment("test.photo.page.requests"),this},activate:function(){return this},closeDialog:function(t){e.config.win.location.href=this.backToURL},getTrackingSegments:function(){return{context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0}},destructor:function(){clearTimeout(this.scrollTimeout)}},{ATTRS:{spaceid:{value:792600552}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-photo"})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-lightbox","photo-css","util-css","fletrics","ttfp-recorder-plugin","signin-helper","hermes-template-error-500","url","fluid-css"],optional:["photo-well-view","photo-head-meta-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-mobile-photo-page",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["global-nav-view"],u):a.call(t,"outlet",t["global-nav-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["mobile-photo-well-view"],u):a.call(t,"outlet",t["mobile-photo-well-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["mobile-photo-engagement-view"],u):a.call(t,"outlet",t["mobile-photo-engagement-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["mobile-attribution-view"],u):a.call(t,"outlet",t["mobile-attribution-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-sidebar-actions-view"],u):a.call(t,"outlet",t["photo-sidebar-actions-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["sub-photo-title-desc-view"],u):a.call(t,"outlet",t["sub-photo-title-desc-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["mobile-sub-photo-stats-view"],u):a.call(t,"outlet",t["mobile-sub-photo-stats-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["sub-photo-comments-view"],u):a.call(t,"outlet",t["sub-photo-comments-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["photo-charm-exif-scrappy-view"],u):a.call(t,"outlet",t["photo-charm-exif-scrappy-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["mobile-sub-photo-license-privacy-view"],u):a.call(t,"outlet",t["mobile-sub-photo-license-privacy-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["sub-photo-tags-tag-view"],u):a.call(t,"outlet",t["sub-photo-tags-tag-view"],u)))+"\n\n",u={hash:{},data:i},s+=f((o=n.outlet||t.outlet,o?o.call(t,t["footer-full-view"],u):a.call(t,"outlet",t["footer-full-view"],u)))+"\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/mobile-photo-page",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-attribution",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i;return r+='\n	<a class="avatar person medium no-menu" data-person-nsid="',(i=n.nsid)?i=i.call(e,{hash:{},data:t}):(i=e.nsid,i=typeof i===f?i.apply(e):i),r+=l(i)+'" style="background-image: url(',(i=n.buddyicon)?i=i.call(e,{hash:{},data:t}):(i=e.buddyicon,i=typeof i===f?i.apply(e):i),r+=l(i)+');" href="/photos/',(i=n.pathAlias)?i=i.call(e,{hash:{},data:t}):(i=e.pathAlias,i=typeof i===f?i.apply(e):i),r+=l(i)+'/"></a>\n',r}function d(e,t){var r="",i;return r+='\n	<div class="avatar person medium" data-person-nsid="',(i=n.nsid)?i=i.call(e,{hash:{},data:t}):(i=e.nsid,i=typeof i===f?i.apply(e):i),r+=l(i)+'" style="background-image: url(',(i=n.buddyicon)?i=i.call(e,{hash:{},data:t}):(i=e.buddyicon,i=typeof i===f?i.apply(e):i),r+=l(i)+');"></div>\n',r}function v(e,t){var r="",i;r+="\n	",i=n["if"].call(e,e.isPro,{hash:{},inverse:c.noop,fn:c.program(6,m,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function m(e,t){return'\n		<span class="pro-badge-inline">PRO</span>\n	'}function g(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.isPro,{hash:{},inverse:c.noop,fn:c.program(9,y,t),data:t});if(i||i===0)r+=i;return r+="\n	",r}function y(e,t){return'\n			<span class="pro-badge-inline">PRO</span>\n		'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;o=n["if"].call(t,t.noMenu,{hash:{},inverse:c.program(3,d,i),fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;s+="\n\n",o=n.unless.call(t,t.isAlbumView,{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(o||o===0)s+=o;s+='\n\n<div class="attribution-info">\n\n	<a href="/photos/',(o=n.pathAlias)?o=o.call(t,{hash:{},data:i}):(o=t.pathAlias,o=typeof o===f?o.apply(t):o),s+=l(o)+'/" class="owner-name truncate" title="',a={hash:{intlName:"attribution.GO_TO_PHOTOSTREAM",name:t.displayname},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):h.call(t,"intlMessage",a)))+'" data-track="attributionNameClick">',(u=n.displayname)?u=u.call(t,{hash:{},data:i}):(u=t.displayname,u=typeof u===f?u.apply(t):u),s+=l(u)+'</a>\n	<a href="/photos/',(u=n.pathAlias)?u=u.call(t,{hash:{},data:i}):(u=t.pathAlias,u=typeof u===f?u.apply(t):u),s+=l(u)+'/" class="owner-name-with-by truncate" title="',a={hash:{intlName:"attribution.GO_TO_PHOTOSTREAM",name:t.displayname},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):h.call(t,"intlMessage",a)))+'" data-track="attributionNameClick">',a={hash:{intlName:"attribution.BY_USER",user:t.displayname},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):h.call(t,"intlMessage",a)))+"</a>\n\n	",a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t.follow,a):h.call(t,"outlet",t.follow,a)))+"\n\n	",u=n["if"].call(t,t.isAlbumView,{hash:{},inverse:c.noop,fn:c.program(8,g,i),data:i});if(u||u===0)s+=u;return s+="\n\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/attribution",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-follow",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i;r+="\n	",i=n["if"].call(e,e.showNoButton,{hash:{},inverse:a.program(4,h,t),fn:a.program(2,c,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function c(e,t){var n="";return n+="\n		\n	",n}function h(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.showUnblockButton,{hash:{},inverse:a.program(7,d,t),fn:a.program(5,p,t),data:t});if(i||i===0)r+=i;return r+="\n	",r}function p(e,t){var r="",i,s;return r+="\n			<button class='follow alt'>",s={hash:{intlName:"common.UNBLOCK"},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,s):o.call(e,"intlMessage",s)))+"</button>\n		",r}function d(e,t){var r="",i;r+="\n			",i=n["if"].call(e,e.showFollowingButton,{hash:{},inverse:a.program(10,m,t),fn:a.program(8,v,t),data:t});if(i||i===0)r+=i;return r+="\n		",r}function v(e,t){return'\n				<button class="follow is-following mini"><span class="drop-icon">\u25be</span></button>\n			'}function m(e,t){return'\n				<button class="follow mini"></button>\n			'}function g(e,t){var r="",i;r+="\n	",i=n["if"].call(e,e.isFluid,{hash:{},inverse:a.program(25,C,t),fn:a.program(13,y,t),data:t});if(i||i===0)r+=i;r+="\n	",i=n["if"].call(e,e.curationEnrollmentStatus,{hash:{},inverse:a.noop,fn:a.program(34,_,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function y(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.showNoButton,{hash:{},inverse:a.program(16,w,t),fn:a.program(14,b,t),data:t});if(i||i===0)r+=i;return r+="\n	",r}function b(e,t){var n="";return n+="\n			\n		",n}function w(e,t){var r="",i;r+="\n			",i=n["if"].call(e,e.showUnblockButton,{hash:{},inverse:a.program(19,S,t),fn:a.program(17,E,t),data:t});if(i||i===0)r+=i;return r+="\n		",r}function E(e,t){var r="",i,s;return r+="\n				<button class='follow alt'>",s={hash:{intlName:"common.UNBLOCK"},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,s):o.call(e,"intlMessage",s)))+"</button>\n			",r}function S(e,t){var r="",i;r+="\n				",i=n["if"].call(e,e.showFollowingButton,{hash:{},inverse:a.program(23,N,t),fn:a.program(20,x,t),data:t});if(i||i===0)r+=i;return r+="\n			",r}function x(e,t){var r="",i,s;r+='\n					<button class="follow is-following ',i=n["if"].call(e,e.isOnDark,{hash:{},inverse:a.noop,fn:a.program(21,T,t),data:t});if(i||i===0)r+=i;return r+='">',s={hash:{intlName:e.followingIntlKey},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,s):o.call(e,"intlMessage",s)))+'<span class="drop-icon">\u25be</span></button>\n				',r}function T(e,t){return"white"}function N(e,t){var r="",i,s;r+='\n					<button class="follow ',i=n["if"].call(e,e.isOnDark,{hash:{},inverse:a.noop,fn:a.program(21,T,t),data:t});if(i||i===0)r+=i;return r+='">',s={hash:{intlName:e.followIntlKey},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,s):o.call(e,"intlMessage",s)))+"</button>\n				",r}function C(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.showNoButton,{hash:{},inverse:a.program(26,k,t),fn:a.program(14,b,t),data:t});if(i||i===0)r+=i;return r+="\n	",r}function k(e,t){var r="",i;r+='\n			<span class="relationship">\n				',i=n["if"].call(e,e.showUnblockButton,{hash:{},inverse:a.program(29,A,t),fn:a.program(27,L,t),data:t});if(i||i===0)r+=i;return r+="\n			</span>\n		",r}function L(e,t){var n="";return n+="\n					\n				",n}function A(e,t){var r="",i;r+="\n					",i=n["if"].call(e,e.showFollowingButton,{hash:{},inverse:a.program(32,M,t),fn:a.program(30,O,t),data:t});if(i||i===0)r+=i;return r+="\n				",r}function O(e,t){var r="",i,s;return r+="\n						<button class='unfluid follow is-following ui-button ui-button-icon ui-button-transparent ui-button-dropdown'><span>",s={hash:{intlName:"common.FOLLOWING"},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,s):o.call(e,"intlMessage",s)))+"</span></button>\n					",r}function M(e,t){var r="",i,s;return r+="\n						<button class='unfluid follow ui-button ui-button-icon'><span>",s={hash:{intlName:"common.FOLLOW"},data:t},r+=u((i=n.intlMessage||e.intlMessage,i?i.call(e,s):o.call(e,"intlMessage",s)))+"</span></button>\n					",r}function _(e,t){var r="",i;return r+="<h3 class='curation-enrollment-status'>[",(i=n.curationEnrollmentStatus)?i=i.call(e,{hash:{},data:t}):(i=e.curationEnrollmentStatus,i=typeof i===f?i.apply(e):i),r+=u(i)+"]</h3>",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o=n.helperMissing,u=this.escapeExpression,a=this,f="function";return s=n["if"].call(t,t.isOnMobile,{hash:{},inverse:a.program(12,g,i),fn:a.program(1,l,i),data:i}),s||s===0?s:""}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/follow",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-following-dropdown",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){return'\n			<label class = "checked">\n				<input type="checkbox" checked="checked" id="friend-checkbox" />\n		'}function p(e,t){return'\n			<label>\n				<input type="checkbox" id="friend-checkbox" />\n		'}function d(e,t){return'\n			<label class="checked">\n				<input type="checkbox" checked="checked" id="family-checkbox" />\n		'}function v(e,t){return'\n			<label>\n				<input type="checkbox" id="family-checkbox" />\n		'}function m(e,t){var r="",i,s;return r+='\n			<button class="follow unfollow">',s={hash:{intlName:"common.UNFOLLOW"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+"</button>\n		",r}function g(e,t){var r="",i,s;return r+='\n			<a href="#"><i class="ui-icon-tiny-unfollow"></i> ',s={hash:{intlName:"common.UNFOLLOW"},data:t},r+=l((i=n.intlMessage||e.intlMessage,i?i.call(e,s):f.call(e,"intlMessage",s)))+"</a>\n		",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<ul>\n	<li class="following-friend">\n		',o=n["if"].call(t,t.isFriend,{hash:{},inverse:c.program(3,p,i),fn:c.program(1,h,i),data:i});if(o||o===0)s+=o;s+="\n			",a={hash:{intlName:"common.FRIEND"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'\n		</label>\n	</li>\n	<li class="following-family">\n		',u=n["if"].call(t,t.isFamily,{hash:{},inverse:c.program(7,v,i),fn:c.program(5,d,i),data:i});if(u||u===0)s+=u;s+="\n			",a={hash:{intlName:"common.FAMILY"},data:i},s+=l((o=n.intlMessage||t.intlMessage,o?o.call(t,a):f.call(t,"intlMessage",a)))+'\n		</label>\n	</li>\n	<li class="divider"></li>\n	<li class="following-unfollow">\n		',u=n["if"].call(t,t.isFluid,{hash:{},inverse:c.program(11,g,i),fn:c.program(9,m,i),data:i});if(u||u===0)s+=u;return s+="\n	</li>\n</ul>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/following-dropdown",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("relationship-menu-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.disableRefreshOnRelationshipChange=e.disableRefreshOnRelationshipChange,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var e=this,t=e.nsid||{pathAlias:e.pathAlias};return e.appContext.getModel("person-relationship-models",t).then(function(t){e.relationship=t,e.nsid=e.nsid||t.id})},buildContainer:function(){return this.setContainerHTML(this.templates("following-dropdown")({isFriend:this.relationship.getValue("isFriend"),isFamily:this.relationship.getValue("isFamily"),isFluid:!0})),this},activate:function(){var e=this.get("container"),t=this;return this.registerEventHandler(this.relationship.on("valuesChanged",function(){t.buildContainer()})),this.registerEventHandler(e.delegate("click",function(e){t.handleUnfollowClick(e)},".following-unfollow")),this.registerEventHandler(e.delegate("change",function(e){t.handleFriendChange(e)},".following-friend input")),this.registerEventHandler(e.delegate("change",function(e){t.handleFamilyChange(e)},".following-family input")),this},handleUnfollowClick:function(t){var n=this;t.preventDefault(),this.relationship.getValue("isContact")&&(this.relationship.registry.toggleFollowing(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(function(){n.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(t){n.relationship.setValue("isContact",!0),n.buildContainer(),e.Flog.error(t)}),e.rapidTracker.beacon(this.name,"unfollowButtonClick"),this.fire("onUnfollow"))},handleFriendChange:function(t){var n=this;this.relationship.registry.toggleFriend(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(function(){n.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(t){n.relationship.registry.toggleFriend(n.nsid),n.buildContainer(),n.onError(n.intlMessage({intlName:"person.RELATIONSHIP_FRIEND_ERROR"})),e.Flog.error(t)})},handleFamilyChange:function(t){var n=this;this.relationship.registry.toggleFamily(this.nsid),this.relationship.registry.remoteUpdate(this.nsid).then(function(){n.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(t){n.relationship.registry.toggleFamily(n.nsid),n.buildContainer(),n.onError(n.intlMessage({intlName:"person.RELATIONSHIP_FAMILY_ERROR"})),e.Flog.error(t)})}})},"@VERSION@",{requires:["promise","flog","fluid-css","hermes-template-following-dropdown","relationship-menu-css"],langBundles:["common","person"]});
YUI.add("hermes-lang-person_zh-hant-hk",function(e,t){e.Intl.add("hermes/person","zh-Hant-HK",{MESSAGE:["\u8a0a\u606f"],ALBUMS:["\u76f8\u7c3f"],FAVES:["\u6700\u611b"],PROFILE:["\u500b\u4eba\u6a94\u6848"],NO_PHOTOS:["\u6b64\u4f7f\u7528\u8005\u6c92\u6709\u53ef\u6aa2\u8996\u7684\u76f8\u7247\u3002"],NO_LONGER_ON_FLICKR:["\u7121\u6b64\u4f7f\u7528\u8005\uff0c\u6216\u6b64\u4f7f\u7528\u8005\u5df2\u4e0d\u518d\u4f7f\u7528 Flickr\u3002"],ERROR_LOADING:["\u8f09\u5165\u4f7f\u7528\u8005\u5361\u7247\u6642\u767c\u751f\u932f\u8aa4\u3002 \u8acb\u518d\u8a66\u4e00\u6b21\u3002"],RELATIONSHIP_FRIEND_ERROR:["\u8a2d\u5b9a\u670b\u53cb\u95dc\u4fc2\u6642\u767c\u751f\u554f\u984c\u3002"],RELATIONSHIP_FAMILY_ERROR:["\u8a2d\u5b9a\u5bb6\u4eba\u95dc\u4fc2\u6642\u767c\u751f\u554f\u984c\u3002"],SIGN_IN_BEFORE_FOLLOW_TITLE:["\u4f60\u627e\u5230\u8ffd\u8e64\u5c0d\u8c61\uff01"],SIGN_IN_BEFORE_FOLLOW_MESSAGE:["\u592a\u597d\u4e86\u3002 \u8acb\u767b\u5165\u4e26\u8ffd\u8e64\u4ed6\u5011\u3002"],JOIN_FLICKR_AND_FOLLOW:["\u52a0\u5165 Flickr\uff0c\u5373\u53ef\u96a8\u6642\u96a8\u5730\u700f\u89bd ","${person}"," \u767c\u4f48\u7684\u5167\u5bb9\u3002"],SIGN_IN_AND_FOLLOW:["\u767b\u5165\u4e26\u8ffd\u8e64"],CURATOR_PASS_OVER:["\u7565\u904e"],CURATOR_PASS_OVER_UNDO:["\u53d6\u6d88\u7565\u904e"]})},"@VERSION@",{requires:["intl"]});
YUI.add("follow-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.set("isActiveViewAgnostic",e.isActiveViewAgnostic),this.nsid=e.nsid,this.pathAlias=e.pathAlias,this.realFullscreen=!!e.realFullscreen,this.isFluid=e.isFluid,this.isOnDark=e.isOnDark,this.disableRefreshOnRelationshipChange=e.disableRefreshOnRelationshipChange,this.isOnMobile=e.isOnMobile,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this},loadState:function(){var e=this,t=e.nsid||{pathAlias:e.pathAlias};return e.appContext.getModel("person-relationship-models",t).then(function(t){e.set("relationship",t),e.nsid=e.nsid||t.id})},buildContainer:function(){var e=this.get("relationship"),t;return t=this.templates("follow")({showNoButton:e.getValue("isMe")||e.getValue("isIgnoredBy"),showUnblockButton:e.getValue("isIgnored"),showFollowingButton:e.getValue("isContact"),signedIn:this.appContext.getViewer().signedIn,isFluid:this.isFluid,isOnMobile:this.isOnMobile,isOnDark:this.isOnDark,followIntlKey:"common.FOLLOW",followingIntlKey:"common.FOLLOWING"}),this.setContainerHTML(t),this},activate:function(){var t=this,n=this.get("container"),r=this.get("relationship"),i,s;return this.isFluid&&!r.getValue("isMe")?this.registerEventHandler(n.delegate("click",function(n){e.rapidTracker.beacon(this.name,"followButtonClick"),i=n.target.hasClass("follow")?n.target:n.target.ancestor(".follow"),t.appContext.getViewer().signedIn?r.getValue("isIgnored")?(r.registry.toggleIgnore(t.nsid),t.disableRefreshOnRelationshipChange?t.buildContainer():t.showBalls(),r.registry.remoteUpdate(t.nsid).then(function(){t.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(n){r.setValue("isIgnored",!0),t.buildContainer(),e.Flog.error(n)})):r.getValue("isContact")?(i.addClass("is-open"),s&&s.destroy(),s=new e.Views.FluidDroparound({appContext:t.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,width:140,height:130,observePageResize:!0,anchorOffsetHorizontal:2,anchorElement:i.one(".drop-icon"),subview:new e.Views["relationship-menu-view"]({nsid:t.nsid,pathAlias:t.pathAlias,disableRefreshOnRelationshipChange:t.disableRefreshOnRelationshipChange}),preferLeft:!0}),s.on("closeDroparound",function(){i.removeClass("is-open"),t.fire("subviewViewEvent","isClosed")}),s.show(),t.fire("subviewViewEvent","isOpen"),s.get("subview").on("onUnfollow",function(){s.close(),s.destroy(),t.disableRefreshOnRelationshipChange?t.buildContainer():t.showBalls()})):t.followPerson():t.signInAndRedirectToPerson()},"button.follow")):(n&&n.one("button")&&this.registerEventHandler(n.one("button").on("click",t.handleRelationshipClick,t)),this.get("relationship").getValue("isMe")||this.setupDropdown()),t},followPerson:function(){var t=this,n=this.get("relationship");n.getValue("isContact")||(n.registry.toggleFollowing(this.nsid),t.disableRefreshOnRelationshipChange?this.buildContainer():this.showBalls(),n.registry.remoteUpdate(this.nsid).then(function(){t.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(r){t.hideBalls(),n.setValue("isContact",!1),t.buildContainer(),e.Flog.error(r)}))},showBalls:function(){this.balls||(this.balls=e.Node.create(this.templates("flickr-balls")({}))),this.get("container").append(this.balls),this.balls.show(),this.get("container").one(".follow").hide()},hideBalls:function(){this.balls&&(this.balls.remove(),this.get("container").one(".follow").show())},handleRelationshipClick:function(t){var n=this;t.preventDefault(),e.rapidTracker.beacon(this.name,"followButtonClick");var r=this.get("relationship").getValue("isContact");this.appContext.getViewer().signedIn?r===!1?(this.followPerson(),e.rapidTracker.beacon(this.name,"photoAttributionFollowButtonClick")):n.isOnMobile?n.handleUnfollowClick(t):(n.relationshipDropDownDialog.toggle(),e.rapidTracker.beacon(this.name,"photoAttributionFollowMenuClick")):n.isOnMobile?e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:n.appContext.getUA().os,isWebview:n.appContext.getUA().isWebview,pageURL:"/photos/"+n.nsid,beacon:{name:"mpp_follow_signedout",section:"attribution-view"},viewName:n.name})}):n.signInAndRedirectToPerson()},handleFriendChange:function(t){var n=this;this.get("relationship").registry.toggleFriend(this.nsid),n.disableRefreshOnRelationshipChange||this.showBalls(),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){n.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(n){this.hideBalls(),this.get("relationship").registry.toggleFriend(this.nsid),t.target.set("checked",!t.target.get("checked")),this.onError(this.intlMessage({intlName:"person.RELATIONSHIP_FRIEND_ERROR"})),e.Flog.error(n)}.bind(this)),t.target.get("checked")?t.target.ancestor().addClass("checked"):t.target.ancestor().removeClass("checked")},handleFamilyChange:function(t){var n=this;this.get("relationship").registry.toggleFamily(this.nsid),n.disableRefreshOnRelationshipChange||this.showBalls(),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){n.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(n){this.hideBalls(),this.get("relationship").registry.toggleFamily(this.nsid),t.target.set("checked",!t.target.get("checked")),this.onError(this.intlMessage({intlName:"person.RELATIONSHIP_FAMILY_ERROR"})),e.Flog.error(n)}.bind(this)),t.target.get("checked")?t.target.ancestor().addClass("checked"):t.target.ancestor().removeClass("checked")},handleUnfollowClick:function(t){var n=this;t.preventDefault(),this.get("relationship").registry.toggleFollowing(this.nsid),n.disableRefreshOnRelationshipChange||this.showBalls(),this.isOnMobile||this.relationshipDropDownDialog.toggle(function(){this.toggleFollowingButton(t.target.ancestor(".relationship"
).one("button"),this.get("relationship").getValue("isContact"))}.bind(this)),this.get("relationship").registry.remoteUpdate(this.nsid).then(function(){n.disableRefreshOnRelationshipChange||(e.config.win.location=e.config.win.location)},function(n){this.hideBalls(),this.get("relationship").setValue("isContact",!0),this.toggleFollowingButton(t.target.ancestor("button"),!0),e.Flog.error(n)}.bind(this)),e.rapidTracker.beacon(this.name,"photoAttributionUnfollowButtonClick")},toggleFollowingButton:function(e,t){t?(e.setContent("<span>"+this.intlMessage({intlName:"common.FOLLOWING"})+"</span>"),e.addClass("follow-anim").addClass("is-following"),setTimeout(function(){e.removeClass("follow-anim")},500),e.addClass("ui-button-dropdown")):(e.addClass("unfollow-anim").removeClass("is-following"),setTimeout(function(){e.removeClass("unfollow-anim")},500),e.one("span").setContent(this.intlMessage({intlName:"common.FOLLOW"})),e.removeClass("ui-button-dropdown"))},onError:function(t){var n=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1});n.show()},setupDropdown:function(){var t=this,n=t.get("container"),r,i=n.one(".relationship"),s,o=n.one(".relationship button");if(!i)return;s=this.templates("following-dropdown")({isFriend:this.get("relationship").getValue("isFriend"),isFamily:this.get("relationship").getValue("isFamily")}),this.relationshipDropDownDialog=e.Views.dialog.getNewInstance("dialog-tooltip",{content:s,anchorTo:n.one(".relationship"),positioning:!1,parent:this}),this.registerEventHandler(this.relationshipDropDownDialog.on("hide",function(e){o.removeClass("is-open")})),this.registerEventHandler(this.relationshipDropDownDialog.on("show",function(e){o.addClass("is-open")})),this.relationshipDropDownDialog.render(),r=this.relationshipDropDownDialog.get("container"),r.detach("click"),this.registerEventHandler(r.one(".following-unfollow").on("click",this.handleUnfollowClick,this)),this.registerEventHandler(r.one(".following-friend input").on("change",this.handleFriendChange,this)),this.registerEventHandler(r.one(".following-family input").on("change",this.handleFamilyChange,this))},showSignUpModal:function(){var t=this;this.appContext.getModel("person-models",this.nsid).then(function(n){var r=t.pathAlias?e.url("/photos/")+t.pathAlias:e.url("/photos/")+t.nsid,i=t.intlMessage({intlName:"person.JOIN_FLICKR_AND_FOLLOW",person:n.getValue("displayname")}),s=n.getValue("buddyicon"),o;s.displayUrl=s.retina||s.large||s.medium||s.default,o=new e.Views.SignUpModal({appContext:t.appContext,signUpHeaderClass:"avatar person large no-menu no-edit",signUpHeaderImage:s.displayUrl,signUpTitle:t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_TITLE"}),signUpMessage:i,beaconPrefix:"follow"}),o.on("signUpClick",function(n){e.SigninHelper.signUpPendingFollow({id:t.nsid},{postLoginUrl:r})}),o.on("signInClick",function(n){e.SigninHelper.addPendingFollow({id:t.nsid},{postLoginUrl:r})}),o.show()})},signInAndRedirectToPerson:function(){var t=this,n=t.pathAlias?e.url("/photos/")+t.pathAlias:e.url("/photos/")+t.nsid,r=t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_MESSAGE"}),i=t.intlMessage({intlName:"person.SIGN_IN_AND_FOLLOW"}),s=t.intlMessage({intlName:"common.CANCEL"}),o;if(this.signedOutTest)return this.showSignUpModal();o=new e.Views.FluidModal({appContext:t.appContext,title:t.intlMessage({intlName:"person.SIGN_IN_BEFORE_FOLLOW_TITLE"}),htmlMessage:r,actionButtonLabel:i,cancelButtonLabel:s}),o.on("actionClick",function(){e.rapidTracker.beacon(t.name,"followModalSigninClick"),e.SigninHelper.addPendingFollow({id:t.nsid},{postLoginUrl:n})}),o.on("cancelClick",function(n){e.rapidTracker.beacon(t.name,"followModalCancelClick")}),o.show()}})},"@VERSION@",{requires:["flickr-view","flog","hermes-template-follow","follow-css","promise","fluid-droparound-view","fluid-modal-view","signup-modal-view","dialog","hermes-template-following-dropdown","hermes-template-flickr-balls","fluid-balls-css","relationship-menu-view","signin-helper"],optional:["person-models","person-relationship-models"],langBundles:["common","person"]});
YUI.add("attribution-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"follow-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return this.hideFollowView}}},initializer:function(e){return this.nsid=e.nsid,this.albumPhotoListLayoutStyle=e.albumPhotoListLayoutStyle,this.realFullscreen=!!e.realFullscreen,this.hideFollowView=e.hideFollowView?e.hideFollowView:!1,this.isAlbumView=e.isAlbumView,this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("person-models",t.nsid)]).then(function(e){t.set("owner",e[0])})},buildContainer:function(){var e=this.get("owner"),t=this.get("container"),n=e.getValue("pathAlias")||e.getValue("nsid"),r,i,s=this;return this.albumPhotoListLayoutStyle==="justified"&&t.addClass("justified-album-details-page"),i=e.getValue("buddyicon").large?e.getValue("buddyicon").large:e.getValue("buddyicon")["default"],r=this.templates("attribution")({isPro:s.appContext.flipper.isFlipped("enable-pro-badge")?e.getValue("isPro"):!1,pathAlias:n,buddyicon:i,nsid:e.getValue("nsid"),displayname:e.getValue("displayname"),follow:this.subviews["follow-view"]?this.subviews["follow-view"].get("container"):"",realFullscreenEnabled:this.realFullscreen&&this.appContext.experiments.fullscreen.getMode(),isAlbumView:this.isAlbumView}),this.setContainerHTML(r),this},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-attribution","photo-attribution-css","promise","follow-view"],optional:["person-models"],langBundles:["attribution"]});
